"use strict";(self.webpackChunklinkspace=self.webpackChunklinkspace||[]).push([[42,776],{73538:(t,e,i)=>{i.r(e),i.d(e,{default:()=>r});var s=i(17527),a=i(56197),n=i(74692);const d="select__placeholder",l="select__menu-item--active",o="select__menu-item--hover";class SelectComponent extends s.uA{constructor(t){super(t),this.el=n(this.element),this.toggleButton=this.el.find(".select__toggle"),this.input=this.el.find("input"),this.menu=this.el.find(".select__menu"),this.options=this.el.find(".select__menu-item"),this.optionChecked="",this.optionHoveredIndex=-1,this.optionsCount=this.options.length,this.isSelectReveal=this.el.hasClass("select--reveal"),this.initSelect(this.el),this.el.hasClass("select--required")&&(0,a.pT)(this.el)}static self=this;initSelect(){this.options&&(this.options.on("click",(t=>{this.handleClick(t)})),this.input.on("change",(t=>{this.handleChange(t)})),this.el.on("show.bs.dropdown",(()=>{this.handleOpen()})),this.input.val()&&this.input.trigger("change"))}addOption(t,e){const i=document.createElement("li");i.classList.add("select__menu-item"),i.setAttribute("role","option"),i.setAttribute("aria-selected","false"),i.setAttribute("data-id",t),i.setAttribute("data-value",e),i.innerHTML=t,this.menu.append(i),this.bindOptionHandler(i),this.options=this.el.find(".select__menu-item")}removeOption(t){this.options.each(((e,i)=>{parseInt(i.dataset.value)===t&&i.remove()}))}updateOption(t,e){this.options.each(((i,s)=>{parseInt(s.dataset.value)===e&&(s.setAttribute("data-id",t),s.innerHTML=t)}))}bindOptionHandler(t){n(t).on("click",(t=>{this.handleClick(t)}))}handleOpen(){this.el.on("keydown",(t=>{this.supportKeyboardNavigation(t)}))}handleClose(t){this.el.dropdown("hide"),t.stopPropagation(),this.el.off("keydown")}handleChange(t){const e=n(t.target).val();""===e?this.resetSelect():this.options.each(((t,i)=>{n(i).data("value").toString()===e&&(this.updateChecked(n(i)),this.isSelectReveal&&this.revealInstance(n(i)))}))}handleClick(t){const e=n(t.target),i=e.data("value"),s=e.data("reveal_id");this.input.val(i).trigger("change"),void 0!==s&&this.input.attr("data-reveal_id",s),this.updateChecked(n(e)),this.isSelectReveal&&this.revealInstance(n(e)),this.toggleButton.trigger("focus")}revealInstance(t){const e=n(`.select-reveal--${this.input.attr("id")} > .select-reveal__instance`);let i="";i=void 0!==t.data("reveal_id")?`#${this.input.attr("id")}_${t.data("reveal_id")}`:`#${this.input.attr("id")}_${t.data("value")}`,e.each(((t,e)=>{n(e).hide(),this.disableFields(e,!0)})),n(i).show(),this.disableFields(n(i),!1)}disableFields(t,e){const i=n(t).find("input, textarea");e?i.prop("disabled",!0):i.removeAttr("disabled")}updateHovered(t){const e=this.options[this.optionHoveredIndex],i=this.options[t];e&&e.classList.remove(o),i&&i.classList.add(o),this.optionHoveredIndex=t}updateChecked(t){const e=n(t).data("value"),i=n(t).html();this.toggleButton.find("span").html(i),this.toggleButton.find("span").removeClass(d),this.options.removeClass(l),this.options.attr("aria-selected",!1),n(t).addClass(l),n(t).attr("aria-selected",!0),this.optionChecked=e}supportKeyboardNavigation(t){if(40===t.keyCode&&this.optionHoveredIndex<this.optionsCount-1&&(t.preventDefault(),this.updateHovered(this.optionHoveredIndex+1)),38===t.keyCode&&this.optionHoveredIndex>0&&(t.preventDefault(),this.updateHovered(this.optionHoveredIndex-1)),13===t.keyCode||32===t.keyCode){t.preventDefault();const e=this.options[this.optionHoveredIndex],i=e&&n(e).data("value");i&&this.input.val(i).trigger("change"),this.handleClose(t)}27===t.keyCode&&this.handleClose(t)}resetSelect(){const t=this.input[0].placeholder;this.toggleButton.find("span").html(t),this.toggleButton.find("span").addClass(d),this.options.removeClass(l),this.options.attr("aria-selected",!1),this.input.removeAttr("value"),this.input.removeAttr("data-restore-value")}}const r=SelectComponent},83208:(t,e,i)=>{i.r(e),i.d(e,{default:()=>h});var s=i(28817),a=i(74692);const n=(t,e)=>{e.DataTable().row.add(t).draw()},d=(t,e,i)=>{e.find("tbody > tr").each(((s,n)=>{a(n).has(`button[data-tempid=${i}]`).length&&e.DataTable().row(s).data(t).draw()}))},l=t=>{t.DataTable().clear().draw()};var o=i(97468),r=i(73538),c=i(74692);class AddTableModalComponent extends s.A{constructor(t){super(t),this.el=c(this.element),this.json={},this.fieldOptions=this.el.find(".modal-body .field-options"),this.topicsTable=this.el.find("#topics"),this.fieldsTable=this.el.find("#fields"),this.selectTopic=this.el.find(".modal-body .select--js-topic")[0],this.selectTopicComponent=new r.default(this.selectTopic),this.currentFieldObject={},this.currentTopicObject={},this.initNewTable(this.el)}initNewTable(){const t=this.el.find(".modal-body .btn-js-create-topic"),e=this.el.find(".modal-body .btn-js-create-field");t.on("click",(()=>{o.y.activate(4,!0)})),e.on("click",(()=>{o.y.activate(7,!0)})),this.fieldOptions.addClass("hidden"),this.setupDataObject()}setupDataObject(){this.json={table_permissions:[],topics:[],fields:[]}}addFieldsToObject(t,e){return t.each(((t,i)=>{c(i).val()&&("checkbox"==c(i).prop("type")?c(i).prop("checked")?e[c(i).attr("name")]=!0:e[c(i).attr("name")]=!1:"topic_tempid"===c(i).attr("name")?e[c(i).attr("name")]=parseInt(c(i).val()):e[c(i).attr("name")]=c(i).val())})),e}addTopic(t){const e=t.find("input, textarea");if(0===Object.keys(this.currentTopicObject).length){let t={tempId:this.uniqueID()};t=this.addFieldsToObject(e,t),this.currentTopicObject=t,this.json.topics.push(t),this.selectTopicComponent.addOption(t.name,t.tempId);const i=[`<button class="btn btn-link btn-js-edit-topic" type="button" data-tempid="${t.tempId}">${t.name}</button>`,t.description||"",t.expanded,""];n(i,this.topicsTable),this.addHandlerToEditItemButton("topic")}else{const t=this.json.topics.find((t=>t.tempId===this.currentTopicObject.tempId));e.each(((e,i)=>{c(i).val()&&(t[c(i).attr("name")]=c(i).val())}));const i=[`<button class="btn btn-link btn-js-edit-topic" type="button" data-tempid="${this.currentTopicObject.tempId}">${this.currentTopicObject.name}</button>`,this.currentTopicObject.description||"",this.currentTopicObject.expanded,""];d(i,this.topicsTable,this.currentTopicObject.tempId),this.selectTopicComponent.updateOption(this.currentTopicObject.name,this.currentTopicObject.tempId),this.addHandlerToEditItemButton("topic")}}fillFields(t,e){for(const[i,s]of Object.entries(e)){const e=t.find(`[name=${i}]`);e&&("checkbox"===e.prop("type")&&!0===s?e.prop("checked",!0):"hidden"===e.prop("type")?(e.val(s),e.trigger("change")):(e.val(s),e.trigger("blur")))}}editTopic(t,e){this.currentTopicObject=t,this.fillFields(c(e),t)}editField(t,e){this.currentFieldObject=t,o.y.clear([8,9]),this.fillFields(c(e),t);const i=t.field_type,s=super.getFrameByNumber(8),a=c(s).find(`[id=field_type_${i}]`);this.fillFields(a,t.field_type_settings);const n=t.custom_field_permissions,d=super.getFrameByNumber(9);n.forEach((t=>{const e=t.group_id,i=c(d).find(`tr[data-group-id=${e}]`);this.fillFields(i,t.permissions)}))}removeNode(t,e){return e.filter((e=>e.tempId!==t))}addHandlerToEditItemButton(t){const e=this.el.find(`.modal-body .btn-js-edit-${t}`);e.off("click");const i="topic"===t?4:7;e.each(((t,e)=>{const s=c(e).data("tempid");c(e).on("click",(()=>{o.y.activate(i,!0,s)}))}))}uniqueID(){return Math.floor(Math.random()*Date.now())}addField(t){const e=t.find("input, textarea");if(0===Object.keys(this.currentFieldObject).length){let t={tempId:this.uniqueID(),custom_field_permissions:[],field_type_settings:{}};t=this.addFieldsToObject(e,t),this.currentFieldObject=t,this.json.fields.push(t);const i=[`<button class="btn btn-link btn-js-edit-field" type="button" data-tempid="${t.tempId}">${t.name}</button>`,t.name,t.topic||"",t["field-type"],""];n(i,this.fieldsTable),this.addHandlerToEditItemButton("field")}else{const t=this.json.fields.find((t=>t.tempId===this.currentFieldObject.tempId));e.each(((e,i)=>{c(i).val()&&(t[c(i).attr("name")]=c(i).val())}));const i=[`<button class="btn btn-link btn-js-edit-field" type="button" data-tempid="${this.currentFieldObject.tempId}">${this.currentFieldObject.name}</button>`,this.currentFieldObject.name,this.currentFieldObject.topic||"",this.currentFieldObject["field-type"],""];d(i,this.fieldsTable,this.currentFieldObject.tempId),this.addHandlerToEditItemButton("field")}}addFieldTypeSettings(t){const e=t.find("[id^=field_type_].select-reveal__instance:visible"),i=e.find("input, textarea"),s=this.json.fields.find((t=>t.tempId===this.currentFieldObject.tempId));switch(e.attr("id")){case"field_type_enum":{const t=e.find('input[name="ordering"]'),i=e.find(".sortable input");let a={dropdown_values:[],ordering:t.val()};i.each(((t,e)=>{let i={};i[c(e).attr("name")]=c(e).val(),a.dropdown_values.push(i)})),s.field_type_settings=a;break}case"field_type_tree":{const t=e.find(".tree-widget-container");let a={data:{},dataJson:{}};if(t.length){const e=t.jstree(!0).get_json("#",{flat:!1}),i=(JSON.stringify(e),t.data().jstree._model.data);a.data=i,a.dataJson=e}a=this.addFieldsToObject(i,a),s.field_type_settings=a;break}case"field_type_curval":{const t=e.find('input[name="curval_field_ids"]:visible'),i=e.find('input:not([name="curval_field_ids"]), textarea');let a={curval_field_ids:[]};t.each(((t,e)=>{c(e).val()&&a.curval_field_ids.push(c(e).val())})),a=this.addFieldsToObject(i,a),s.field_type_settings=a;break}default:{let t={};t=this.addFieldsToObject(i,t),s.field_type_settings=t}}}addTable(t){const e=t.find("input, textarea"),i=this.el.find(".modal-title");e.each(((t,e)=>{c(e).val()&&(this.json[c(e).attr("name")]=c(e).val())})),this.json.name&&i.html(`Table setup | ${this.json.name}`)}addCustomFieldPermissions(t){const e=t.find("#custom_field_permissions_table").DataTable().rows(),i=this.json.fields.find((t=>t.tempId===this.currentFieldObject.tempId));i.custom_field_permissions=[],e.every((()=>{const t=this.nodes()[0],e=t.dataset.groupId,s=c(t).find("td")[0].innerHTML.trim(),a=c(t).find("input");let n={group_id:e,group_name:s,permissions:{}};n.permissions=this.addFieldsToObject(a,n.permissions),i.custom_field_permissions.push(n)}))}addTablePermissions(t){t.find(".card--expandable").each(((t,e)=>{const i=c(e).closest(".permission-group"),s=i&&void 0!==i.data("group-id")?i.data("group-id"):"",a=c(e).find(".card__subtitle")[0].innerHTML.trim(),n=c(e).find("fieldset");let d={group_id:s,group_name:a,records:{},views:{},fields:{}};n.each(((t,e)=>{const i=c(e).data("name"),s=c(e).find("input");d[i]=this.addFieldsToObject(s,d[i])})),this.json.table_permissions.push(d)}))}handleNext(t){switch(super.handleNext(),t.data("config").item){case"topic":this.addTopic(t);break;case"field":this.addField(t);break;case"field type settings":this.addFieldTypeSettings(t),this.recalculateDatatableColumnWidths(c("#custom_field_permissions_table"));break;case"custom field permissions":this.addCustomFieldPermissions(t);break;case"table":this.addTable(t);break;case"table permissions":this.addTablePermissions(t);break;default:{const e=t.find("input, textarea");this.addFieldsToObject(e,this.json)}}}recalculateDatatableColumnWidths(t){t.DataTable().columns.adjust()}handleBack(){super.handleBack()}handleSave(){o.y.upload(this.json)}handleUpdate(t){"topic"===t.data("config").item?(this.addTopic(t),this.currentTopicObject={}):"field"===t.data("config").item&&(this.addField(t),this.currentFieldObject={})}handleActivate(t,e,i){if(super.handleActivate(t,e),7===t&&i){const e=super.getFrameByNumber(t),s=this.json.fields.find((t=>t.tempId===i));this.editField(s,e)}else if(7===t&&e)this.currentFieldObject={},o.y.clear([8,9]);else if(4===t&&i){const e=super.getFrameByNumber(t),s=this.json.topics.find((t=>t.tempId===i));this.editTopic(s,e)}else 4===t&&e&&(this.currentTopicObject={});super.validateFrame()}handleClose(){this.el.find(".collapse").collapse("hide"),this.topicsTable&&l(this.topicsTable),this.fieldsTable&&l(this.fieldsTable),this.selectTopicComponent.options.each(((t,e)=>{this.selectTopicComponent.removeOption(parseInt(e.dataset.value))})),this.setupDataObject(),this.currentFieldObject={},this.currentTopicObject={},super.handleClose()}}const h=AddTableModalComponent},50349:(t,e,i)=>{i.r(e),i.d(e,{default:()=>d});var s=i(97468),a=i(28817),n=i(74692);class UserModalComponent extends a.A{constructor(t){super(t),this.el=n(this.element),this.emailField=this.el.find('input[name="email"]'),this.emailText=this.el.find(".js-email"),this.initUserModal()}initUserModal(){this.el.on("show.bs.modal",(t=>{this.toggleContent(t),s.y.validate(),this.updateEmail(),this.emailField.keyup((()=>{this.updateEmail()}))}))}toggleContent(t){this.target=n(t.relatedTarget),this.target.hasClass("btn-add")?(s.y.clear(),this.el.find(".js-approve-account").hide(),this.el.find(".js-add-user").show(),this.el.find(".btn-js-reject-request").hide(),this.el.find(".btn-js-save .btn__title").html("Create account"),this.el.find('input[name="approve-account"]').val("false")):(this.el.find(".js-add-user").hide(),this.el.find(".js-approve-account").show(),this.el.find(".btn-js-reject-request").show().on("click",(()=>{this.activateFrame(4)})),this.el.find(".btn-js-save .btn__title").html("Approve account"),this.el.find('input[name="approve-account"]').val("true"))}updateEmail(){this.emailText.html(this.emailField.val())}getData(){const t={view_limits:[],permissions:[],groups:[]};return this.el.find("input, textarea").each(((e,i)=>{if("radio"===n(i).prop("type")||"checkbox"===n(i).prop("type")){if(n(i).prop("checked")){const e=isNaN(n(i).val())?n(i).val():parseInt(n(i).val());Array.isArray(t[n(i).attr("name")])?t[n(i).attr("name")].push(e):t[n(i).attr("name")]=e}}else if(n(i).val()||n(i).value){const e=n(i).val()||n(i).value,s=isNaN(e)?this.parseValue(e):parseInt(e);Array.isArray(t[n(i).attr("name")])?t[n(i).attr("name")].push(s):t[n(i).attr("name")]=s}})),t}parseValue(t){return"true"===t||"false"!==t&&t}handleSave(){s.y.upload(this.getData())}handleClose(){super.handleClose(),this.emailText.html("USER")}handleBack(){super.handleBack(),this.target.hasClass("btn-add")||this.el.find(".btn-js-reject-request").off().on("click",(()=>{this.activateFrame(4)}))}handleNext(){super.handleNext(),this.target.hasClass("btn-add")||this.el.find(".btn-js-reject-request").off().on("click",(()=>{this.activateFrame(4)}))}}const d=UserModalComponent}}]);