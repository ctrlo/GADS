(self.webpackChunklinkspace=self.webpackChunklinkspace||[]).push([["modal--newtable"],{"./src/frontend/components/data-table/lib/helper.js":(e,t,o)=>{"use strict";o.r(t),o.d(t,{addRow:()=>i,clearTable:()=>r,updateRow:()=>s});o("./node_modules/core-js/modules/es.array.find.js"),o("./node_modules/core-js/modules/es.object.to-string.js");var n=o("./node_modules/jquery/dist/jquery.js"),i=function(e,t){t.DataTable().row.add(e).draw()},s=function(e,t,o){t.find("tbody > tr").each((function(i,s){n(s).has("button[data-tempid=".concat(o,"]")).length&&t.DataTable().row(i).data(e).draw()}))},r=function(e){e.DataTable().clear().draw()}},"./src/frontend/components/modal/modals/new-table/lib/component.js":(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>j});o("./node_modules/core-js/modules/es.array.find.js"),o("./node_modules/core-js/modules/es.object.to-string.js"),o("./node_modules/core-js/modules/es.parse-int.js"),o("./node_modules/core-js/modules/es.object.keys.js"),o("./node_modules/core-js/modules/es.function.name.js"),o("./node_modules/core-js/modules/es.array.concat.js"),o("./node_modules/core-js/modules/es.symbol.js"),o("./node_modules/core-js/modules/es.symbol.description.js"),o("./node_modules/core-js/modules/es.object.entries.js"),o("./node_modules/core-js/modules/web.dom-collections.for-each.js"),o("./node_modules/core-js/modules/es.array.filter.js"),o("./node_modules/core-js/modules/es.json.stringify.js"),o("./node_modules/core-js/modules/es.string.trim.js"),o("./node_modules/core-js/modules/es.object.get-prototype-of.js"),o("./node_modules/core-js/modules/es.reflect.to-string-tag.js"),o("./node_modules/core-js/modules/es.reflect.construct.js"),o("./node_modules/core-js/modules/es.reflect.get.js"),o("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),o("./node_modules/core-js/modules/es.symbol.to-primitive.js"),o("./node_modules/core-js/modules/es.date.to-primitive.js"),o("./node_modules/core-js/modules/es.number.constructor.js"),o("./node_modules/core-js/modules/es.symbol.iterator.js"),o("./node_modules/core-js/modules/es.array.iterator.js"),o("./node_modules/core-js/modules/es.string.iterator.js"),o("./node_modules/core-js/modules/web.dom-collections.iterator.js"),o("./node_modules/core-js/modules/es.array.slice.js"),o("./node_modules/core-js/modules/es.array.from.js"),o("./node_modules/core-js/modules/es.regexp.exec.js"),o("./node_modules/core-js/modules/es.regexp.test.js");var n=o("./src/frontend/components/modal/lib/component.js"),i=o("./src/frontend/components/data-table/lib/helper.js"),s=o("./src/frontend/components/modal/lib/modal.js"),r=o("./src/frontend/components/form-group/select/lib/component.js"),a=o("./node_modules/jquery/dist/jquery.js");function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,i,s,r,a=[],d=!0,l=!1;try{if(s=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;d=!1}else for(;!(d=(n=s.call(o)).done)&&(a.push(n.value),a.length!==t);d=!0);}catch(e){l=!0,i=e}finally{try{if(!d&&null!=o.return&&(r=o.return(),Object(r)!==r))return}finally{if(l)throw i}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function u(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,s=void 0,s=function(e,t){if("object"!==d(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,t||"default");if("object"!==d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===d(s)?s:String(s)),n)}var i,s}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,o){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:o):i.value}},f.apply(this,arguments)}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=b(e);if(t){var i=b(this).constructor;o=Reflect.construct(n,arguments,i)}else o=n.apply(this,arguments);return function(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,o)}}function b(e){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},b(e)}const j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(c,e);var t,o,n,d=m(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=d.call(this,e)).el=a(t.element),t.json={},t.fieldOptions=t.el.find(".modal-body .field-options"),t.topicsTable=t.el.find("#topics"),t.fieldsTable=t.el.find("#fields"),t.selectTopic=t.el.find(".modal-body .select--js-topic")[0],t.selectTopicComponent=new r.default(t.selectTopic),t.currentFieldObject={},t.currentTopicObject={},t.initNewTable(t.el),t}return t=c,(o=[{key:"initNewTable",value:function(e){var t=this.el.find(".modal-body .btn-js-create-topic"),o=this.el.find(".modal-body .btn-js-create-field");t.on("click",(function(e){s.modal.activate(4,!0)})),o.on("click",(function(e){s.modal.activate(7,!0)})),this.fieldOptions.addClass("hidden"),this.setupDataObject()}},{key:"setupDataObject",value:function(){this.json={table_permissions:[],topics:[],fields:[]}}},{key:"addFieldsToObject",value:function(e,t){return e.each((function(e,o){a(o).val()&&("checkbox"==a(o).prop("type")?a(o).prop("checked")?t[a(o).attr("name")]=!0:t[a(o).attr("name")]=!1:"topic_tempid"===a(o).attr("name")?t[a(o).attr("name")]=parseInt(a(o).val()):t[a(o).attr("name")]=a(o).val())})),t}},{key:"addTopic",value:function(e){var t=this,o=e.find("input, textarea");if(0===Object.keys(this.currentTopicObject).length){var n={tempId:this.uniqueID()};n=this.addFieldsToObject(o,n),this.currentTopicObject=n,this.json.topics.push(n),this.selectTopicComponent.addOption(n.name,n.tempId);var s=['<button class="btn btn-link btn-js-edit-topic" type="button" data-tempid="'.concat(n.tempId,'">').concat(n.name,"</button>"),n.description||"",n.expanded,""];i.addRow(s,this.topicsTable),this.addHandlerToEditItemButton("topic")}else{var r=this.json.topics.find((function(e){return e.tempId===t.currentTopicObject.tempId}));o.each((function(e,t){a(t).val()&&(r[a(t).attr("name")]=a(t).val())}));var d=['<button class="btn btn-link btn-js-edit-topic" type="button" data-tempid="'.concat(this.currentTopicObject.tempId,'">').concat(this.currentTopicObject.name,"</button>"),this.currentTopicObject.description||"",this.currentTopicObject.expanded,""];i.updateRow(d,this.topicsTable,this.currentTopicObject.tempId),this.selectTopicComponent.updateOption(this.currentTopicObject.name,this.currentTopicObject.tempId),this.addHandlerToEditItemButton("topic")}}},{key:"fillFields",value:function(e,t){for(var o=0,n=Object.entries(t);o<n.length;o++){var i=l(n[o],2),s=i[0],r=i[1],a=e.find("[name=".concat(s,"]"));a&&("checkbox"===a.prop("type")&&!0===r?a.prop("checked",!0):"hidden"===a.prop("type")?(a.val(r),a.trigger("change")):(a.val(r),a.trigger("blur")))}}},{key:"editTopic",value:function(e,t){this.currentTopicObject=e,this.fillFields(a(t),e)}},{key:"editField",value:function(e,t){var o=this;this.currentFieldObject=e,s.modal.clear([8,9]),this.fillFields(a(t),e);var n=e.field_type,i=f(b(c.prototype),"getFrameByNumber",this).call(this,8),r=a(i).find("[id=field_type_".concat(n,"]"));this.fillFields(r,e.field_type_settings);var d=e.custom_field_permissions,l=f(b(c.prototype),"getFrameByNumber",this).call(this,9);d.forEach((function(e){var t=e.group_id,n=a(l).find("tr[data-group-id=".concat(t,"]"));o.fillFields(n,e.permissions)}))}},{key:"removeNode",value:function(e,t){return t.filter((function(t){return t.tempId!==e}))}},{key:"addHandlerToEditItemButton",value:function(e){var t=this.el.find(".modal-body .btn-js-edit-".concat(e));t.off("click");var o="topic"===e?4:7;t.each((function(e,t){var n=a(t).data("tempid");a(t).on("click",(function(e){s.modal.activate(o,!0,n)}))}))}},{key:"uniqueID",value:function(){return Math.floor(Math.random()*Date.now())}},{key:"addField",value:function(e){var t=this,o=e.find("input, textarea");if(0===Object.keys(this.currentFieldObject).length){var n={tempId:this.uniqueID(),custom_field_permissions:[],field_type_settings:{}};n=this.addFieldsToObject(o,n),this.currentFieldObject=n,this.json.fields.push(n);var s=['<button class="btn btn-link btn-js-edit-field" type="button" data-tempid="'.concat(n.tempId,'">').concat(n.name,"</button>"),n.name,n.topic||"",n["field-type"],""];i.addRow(s,this.fieldsTable),this.addHandlerToEditItemButton("field")}else{var r=this.json.fields.find((function(e){return e.tempId===t.currentFieldObject.tempId}));o.each((function(e,t){a(t).val()&&(r[a(t).attr("name")]=a(t).val())}));var d=['<button class="btn btn-link btn-js-edit-field" type="button" data-tempid="'.concat(this.currentFieldObject.tempId,'">').concat(this.currentFieldObject.name,"</button>"),this.currentFieldObject.name,this.currentFieldObject.topic||"",this.currentFieldObject["field-type"],""];i.updateRow(d,this.fieldsTable,this.currentFieldObject.tempId),this.addHandlerToEditItemButton("field")}}},{key:"addFieldTypeSettings",value:function(e){var t=this,o=e.find("[id^=field_type_].select-reveal__instance:visible"),n=o.find("input, textarea"),i=this.json.fields.find((function(e){return e.tempId===t.currentFieldObject.tempId}));switch(o.attr("id")){case"field_type_enum":var s=o.find('input[name="ordering"]'),r=o.find(".sortable input"),d={dropdown_values:[],ordering:s.val()};r.each((function(e,t){var o={};o[a(t).attr("name")]=a(t).val(),d.dropdown_values.push(o)})),i.field_type_settings=d;break;case"field_type_tree":var l=o.find(".tree-widget-container"),c={data:{},dataJson:{}};if(l.length){var u=l.jstree(!0).get_json("#",{flat:!1}),f=(JSON.stringify(u),l.data().jstree._model.data);c.data=f,c.dataJson=u}c=this.addFieldsToObject(n,c),i.field_type_settings=c;break;case"field_type_curval":var p=o.find('input[name="curval_field_ids"]:visible'),m=o.find('input:not([name="curval_field_ids"]), textarea'),b={curval_field_ids:[]};p.each((function(e,t){a(t).val()&&b.curval_field_ids.push(a(t).val())})),b=this.addFieldsToObject(m,b),i.field_type_settings=b;break;default:var j={};j=this.addFieldsToObject(n,j),i.field_type_settings=j}}},{key:"addTable",value:function(e){var t=e.find("input, textarea"),o=this.el.find(".modal-title"),n=this;t.each((function(e,t){a(t).val()&&(n.json[a(t).attr("name")]=a(t).val())})),this.json.name&&o.html("Table setup | ".concat(this.json.name))}},{key:"addCustomFieldPermissions",value:function(e){var t=this,o=this,n=e.find("#custom_field_permissions_table").DataTable().rows(),i=o.json.fields.find((function(e){return e.tempId===t.currentFieldObject.tempId}));i.custom_field_permissions=[],n.every((function(e){var t=this.nodes()[0],n=t.dataset.groupId,s=a(t).find("td")[0].innerHTML.trim(),r=a(t).find("input"),d={group_id:n,group_name:s,permissions:{}};d.permissions=o.addFieldsToObject(r,d.permissions),i.custom_field_permissions.push(d)}))}},{key:"addTablePermissions",value:function(e){var t=this,o=e.find(".card--expandable"),n=this;o.each((function(e,o){var i=a(o).closest(".permission-group"),s=i&&void 0!==i.data("group-id")?i.data("group-id"):"",r=a(o).find(".card__subtitle")[0].innerHTML.trim(),d=a(o).find("fieldset"),l={group_id:s,group_name:r,records:{},views:{},fields:{}};d.each((function(e,o){var n=a(o).data("name"),i=a(o).find("input");l[n]=t.addFieldsToObject(i,l[n])})),n.json.table_permissions.push(l)}))}},{key:"handleNext",value:function(e){switch(f(b(c.prototype),"handleNext",this).call(this),e.data("config").item){case"topic":this.addTopic(e);break;case"field":this.addField(e);break;case"field type settings":this.addFieldTypeSettings(e),this.recalculateDatatableColumnWidths(a("#custom_field_permissions_table"));break;case"custom field permissions":this.addCustomFieldPermissions(e);break;case"table":this.addTable(e);break;case"table permissions":this.addTablePermissions(e);break;default:var t=e.find("input, textarea");this.addFieldsToObject(t,this.json)}}},{key:"recalculateDatatableColumnWidths",value:function(e){e.DataTable().columns.adjust()}},{key:"handleBack",value:function(e){f(b(c.prototype),"handleBack",this).call(this)}},{key:"handleSave",value:function(){s.modal.upload(this.json)}},{key:"handleUpdate",value:function(e){"topic"===e.data("config").item?(this.addTopic(e),this.currentTopicObject={}):"field"===e.data("config").item&&(this.addField(e),this.currentFieldObject={})}},{key:"handleActivate",value:function(e,t,o){if(f(b(c.prototype),"handleActivate",this).call(this,e,t),7===e&&o){var n=f(b(c.prototype),"getFrameByNumber",this).call(this,e),i=this.json.fields.find((function(e){return e.tempId===o}));this.editField(i,n)}else if(7===e&&t)this.currentFieldObject={},s.modal.clear([8,9]);else if(4===e&&o){var r=f(b(c.prototype),"getFrameByNumber",this).call(this,e),a=this.json.topics.find((function(e){return e.tempId===o}));this.editTopic(a,r)}else 4===e&&t&&(this.currentTopicObject={});f(b(c.prototype),"validateFrame",this).call(this)}},{key:"handleClose",value:function(){var e=this;this.el.find(".collapse").collapse("hide"),this.topicsTable&&i.clearTable(this.topicsTable),this.fieldsTable&&i.clearTable(this.fieldsTable),this.selectTopicComponent.options.each((function(t,o){e.selectTopicComponent.removeOption(parseInt(o.dataset.value))})),this.setupDataObject(),this.currentFieldObject={},this.currentTopicObject={},f(b(c.prototype),"handleClose",this).call(this)}}])&&u(t.prototype,o),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(n.default)},"./node_modules/core-js/internals/string-trim-forced.js":(e,t,o)=>{var n=o("./node_modules/core-js/internals/function-name.js").PROPER,i=o("./node_modules/core-js/internals/fails.js"),s=o("./node_modules/core-js/internals/whitespaces.js");e.exports=function(e){return i((function(){return!!s[e]()||"​᠎"!=="​᠎"[e]()||n&&s[e].name!==e}))}},"./node_modules/core-js/modules/es.object.keys.js":(e,t,o)=>{var n=o("./node_modules/core-js/internals/export.js"),i=o("./node_modules/core-js/internals/to-object.js"),s=o("./node_modules/core-js/internals/object-keys.js");n({target:"Object",stat:!0,forced:o("./node_modules/core-js/internals/fails.js")((function(){s(1)}))},{keys:function(e){return s(i(e))}})},"./node_modules/core-js/modules/es.string.trim.js":(e,t,o)=>{"use strict";var n=o("./node_modules/core-js/internals/export.js"),i=o("./node_modules/core-js/internals/string-trim.js").trim;n({target:"String",proto:!0,forced:o("./node_modules/core-js/internals/string-trim-forced.js")("trim")},{trim:function(){return i(this)}})}}]);
//# sourceMappingURL=modal--newtable.215ecac08c686d55d2bc.js.map