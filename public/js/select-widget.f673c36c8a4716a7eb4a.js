"use strict";(self.webpackChunklinkspace=self.webpackChunklinkspace||[]).push([[591],{21330:(e,t,i)=>{i.r(t),i.d(t,{default:()=>h});i(25728),i(60228),i(34338),i(50886),i(32320),i(38077),i(76801),i(43843),i(752),i(73964),i(21694),i(76265),i(6203),i(88052),i(76034),i(30050),i(69373),i(59903),i(59749),i(86544),i(79288),i(84254);var n=i(53865),a=i(60387),r=i(22092),s=i(19755);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(a=n.key,r=void 0,r=function(e,t){if("object"!==l(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a,"string"),"symbol"===l(r)?r:String(r)),n)}var a,r}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=u(e);if(t){var a=u(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,i)}}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}const h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(h,e);var t,n,l,u=d(h);function h(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(t=u.call(this,e)).el=s(t.element),t.$selectWidget=t.el,t.$widget=t.el.find(".form-control"),t.$trigger=t.$widget.find("[aria-expanded]"),t.$current=t.el.find(".current"),t.$available=t.el.find(".available"),t.$availableItems=t.el.find(".available .answer input"),t.$moreInfoButtons=t.el.find(".available .answer .btn-js-more-info"),t.$target=t.el.find("#"+t.$trigger.attr("aria-controls")),t.$currentItems=t.$current.find("[data-list-item]"),t.$answers=t.el.find(".answer"),t.$fakeInput=null,t.$search=t.el.find(".form-control-search"),t.lastFetchParams=null,t.multi=t.el.hasClass("multi"),t.timeout,t.required=t.el.hasClass("select-widget--required"),t.loadCounter=0,t.initSelectWidget(),t.required&&(0,r.Kg)(t.el),t}return t=h,(n=[{key:"initSelectWidget",value:function(){var e=this;this.updateState(),this.$widget.is("[readonly]")||(this.connect(),this.$widget.unbind("click"),this.$widget.on("click",(function(){e.handleWidgetClick()})),this.$search.unbind("blur"),this.$search.on("blur",(function(t){e.possibleCloseWidget(t)})),this.$availableItems.unbind("blur"),this.$availableItems.on("blur",(function(t){e.possibleCloseWidget(t)})),this.$moreInfoButtons.unbind("blur"),this.$moreInfoButtons.on("blur",(function(t){e.possibleCloseWidget(t)})),s(document).on("click",(function(t){e.handleDocumentClick(t)})),s(document).keyup((function(e){27==e.keyCode&&this.collapse(this.$widget,this.$trigger,this.$target)})),this.$widget.delegate(".select-widget-value__delete","click",(function(e){e.preventDefault(),e.stopPropagation();var t=e.target.parentElement.getAttribute("data-list-item"),i=document.getElementById(t);i.checked=!1,s(i).parent().trigger("click"),s(i).trigger("change")})),this.$search.unbind("focus",this.expandWidgetHandler),this.$search.on("focus",(function(t){e.expandWidgetHandler(t)})),this.$search.unbind("keydown"),this.$search.on("keydown",(function(t){e.handleKeyDown(t)})),this.$search.unbind("keyup"),this.$search.on("keyup",(function(t){e.handleKeyUp(t)})),this.$search.unbind("click"),this.$search.on("click",(function(e){e.stopPropagation()})))}},{key:"handleWidgetClick",value:function(){"true"===this.$trigger.attr("aria-expanded")?this.collapse(this.$widget,this.$trigger,this.$target):this.expand(this.$widget,this.$trigger,this.$target)}},{key:"handleDocumentClick",value:function(e){!this.el.is(e.target)&&0===this.el.has(e.target).length&&this.collapse(this.$widget,this.$trigger,this.$target)}},{key:"handleKeyUp",value:function(e){var t=s(e.target).val().toLowerCase(),i=this;if(this.$fakeInput=this.$fakeInput||s("<span>").addClass("form-control-search").css("white-space","nowrap"),this.$fakeInput.text(t),this.$search.css("width",this.$fakeInput.insertAfter(this.$search).width()+100),this.$fakeInput.detach(),"typeahead"==this.$selectWidget.data("value-selector")){var n="/".concat(this.$selectWidget.data("layout-id"),"/match/layout/").concat(this.$selectWidget.data("typeahead-id"));clearTimeout(this.timeout),this.$available.find(".spinner").removeAttr("hidden"),this.timeout=setTimeout((function(){i.$available.find(".answer").not(".answer--blank").each((function(){var e=s(this);e.find("input:checked").length||e.remove()})),i.updateJson(n+"?noempty=1&q="+t,!0)}),200)}else{var a=!1;s.each(this.$answers,(function(){-1===s(this).find("label")[0].innerHTML.toLowerCase().indexOf(t)?s(this).attr("hidden",""):(a=!0,s(this).removeAttr("hidden",""))})),a?this.$available.find(".has-noresults").attr("hidden",""):this.$available.find(".has-noresults").removeAttr("hidden","")}}},{key:"handleKeyDown",value:function(e){var t=e.which||e.keyCode;switch(this.expand(this.$widget,this.$trigger,this.$target),t){case 38:case 40:var i,n=this.$available.find(".answer:not([hidden]) input");e.preventDefault(),(i=38===t?n[n.length-1]:n[0])&&s(i).focus();break;case 13:e.preventDefault();var a=this.$available.find(".answer:not([hidden]) input").get(0);a&&s(a).parent().trigger("click")}}},{key:"expandWidgetHandler",value:function(e){e.stopPropagation(),this.expand(this.$widget,this.$trigger,this.$target)}},{key:"collapse",value:function(e,t){var i=this;this.$selectWidget.removeClass("select-widget--open"),t.attr("aria-expanded",!1),setTimeout((function(){i.$search.val(""),i.$target.attr("hidden",""),i.$answers.removeAttr("hidden")}),50)}},{key:"updateState",value:function(){var e=this.$current.children("[data-list-item]:not([hidden])");this.$current.toggleClass("empty",0===e.length)}},{key:"possibleCloseWidget",value:function(e){var t=e.relatedTarget||document.activeElement;this.$selectWidget.find(t).length||!t||s(t).is(".modal, .page, body")||this.$selectWidget.get(0).parentNode===t||this.collapse(this.$widget,this.$trigger,this.$target)}},{key:"connectMulti",value:function(){return function(){var e=s(this),t=e.data("list-item"),i=s("#"+t),n=this;i.unbind("change"),i.on("change",(function(t){s(t.target).prop("checked")?e.removeAttr("hidden"):e.attr("hidden",""),n.updateState()})),i.unbind("keydown"),i.on("keydown",(function(e){var t=e.which||e.keyCode;switch(t){case 38:case 40:var a,r=n.$answers.index(i.closest(".answer"));e.preventDefault(),(a=38===t?n.$answers[r-1]:n.$answers[r+1])&&s(a).find("input").focus();break;case 13:e.preventDefault(),s(this).trigger("click")}}))}}},{key:"connectSingle",value:function(){var e=this,t=this;this.$currentItems.each((function(i,n){var a=s(n),r=a.data("list-item"),l=s("#"+r);l.off("click"),l.on("click",(function(e){e.stopPropagation()})),l.off("change"),l.on("change",(function(){t.$currentItems.each((function(e,t){s(t).attr("hidden","")})),l.prop("checked")&&a.removeAttr("hidden"),t.updateState()})),l.parent().unbind("keypress"),l.parent().on("keypress",(function(e){13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),s(e.target).parent().trigger("click"))})),l.parent().off("click"),l.parent().on("click",(function(){e.collapse(e.$widget,e.$trigger,e.$target)}))}))}},{key:"connect",value:function(){this.multi?this.$currentItems.each(this.connectMulti()):this.connectSingle()}},{key:"currentLi",value:function(e,t,i,n,a,r){if(e&&!i)return s('<li class="none-selected">blank</li>');var l=s("<li "+(r?"":"hidden")+' data-list-item="'+(i?t+"_"+i:t+"__blank")+'" class="'+(i?"":"current__blank")+'"><span class="widget-value__value"></span><button type="button" class="close select-widget-value__delete" aria-hidden="true" aria-label="delete" title="delete" tabindex="-1">&times</button></li>');return l.data("list-text",n),l.data("list-id",i),l.find("span").html(a),l}},{key:"availableLi",value:function(e,t,i,n,a,r){if(this.multi&&!i)return null;var l=i?t+"_"+i:t+"__blank",o=i?"answer":"answer answer--blank",c=' <div class="details"><button type="button" class="btn btn-small btn-default btn-js-more-info" data-record-id="'+i+'" aria-describedby="lbl-'+l+'" data-target="'+this.el.data("details-modal")+'" data-toggle="modal">Details</button></div>',d=s('<li class="'+o+'"><div class="control"><div class="'+(e?"checkbox":"radio-group__option")+'"><input id="'+l+'" type="'+(e?"checkbox":"radio")+'" name="'+t+'" '+(r?" checked":"")+(this.required&&!this.multi?' required aria-required="true"':"")+' value="'+(i||"")+'" class="'+(e?"":"visually-hidden")+'" aria-labelledby="lbl-'+l+'"> <label id="lbl-'+l+'" for="'+l+'">'+a+"</label></div></div>"+(i?c:"")+"</li>");return d.data("list-text",n),d.data("list-id",i),d}},{key:"updateJson",value:function(e,t){this.loadCounter++;var n=this,r=this.loadCounter;this.$available.find(".spinner").removeAttr("hidden");var l=this.$available.find("input:checked").map((function(){return parseInt(s(this).val())})).get();t||this.$available.find(".answer").remove();var o=this.$selectWidget.data("field"),c=!0;s.getJSON(e,(function(e){var n=this;if(0===e.error){if(r!=this.loadCounter)return void(c=!1);t?this.$currentItems.filter(":hidden").remove():this.$currentItems.remove();var a=l.includes(NaN);this.multi&&(this.$search.parent().prevAll(".none-selected").remove(),this.$search.parent().before(this.currentLi(this.multi,o,null,"","blank",a)),this.$available.append(this.availableLi(this.multi,o,null,"","blank",a))),s.each(e.records,(function(e,i){var a=l.includes(i.id);(!t||t&&!a)&&(n.$search.parent().before(n.currentLi(n.multi,o,i.id,i.label,i.html,a)).before(" "),n.$available.append(n.availableLi(n.multi,o,i.id,i.label,i.html,a)))})),this.$currentItems=this.$current.find("[data-list-item]"),this.$available=this.$selectWidget.find(".available"),this.$availableItems=this.$selectWidget.find(".available .answer input"),this.$moreInfoButtons=this.$selectWidget.find(".available .answer .btn-js-more-info"),this.$answers=this.$selectWidget.find(".answer"),this.updateState(),this.connect(),this.$availableItems.on("blur",(function(e){n.possibleCloseWidget(e)})),this.$moreInfoButtons.on("blur",(function(e){n.possibleCloseWidget(e)})),this.$moreInfoButtons.each((function(e,t){i.e(683).then(i.bind(i,66303)).then((function(e){new(0,e.default)(t)}))}))}else{var d=1===e.error?e.message:"Oops! Something went wrong.",u=s('<li class="answer answer--blank alert alert-danger d-flex flex-row justify-content-start"><span class="control"><label>'+d+"</label></span></li>");this.$available.append(u)}})).fail((function(t,i,r){a.P.error("Failed to make request to "+e+": "+i+": "+r);var l=s('<li class="answer answer--blank alert alert-danger"><span class="control"><label>Oops! Something went wrong.</label></span></li>');n.$available.append(l)})).always((function(){c&&n.$available.find(".spinner").attr("hidden","")}))}},{key:"fetchOptions",value:function(){var e=this.$selectWidget.data("filter-endpoint"),t=this.$selectWidget.data("filter-fields"),i=this.$selectWidget.data("submission-token");if(!Array.isArray(t))throw"Invalid data-filter-fields found. It should be a proper JSON array of fields.";var n=["submission-token="+i];s.each(t,(function(e,t){s("input[name="+t+"]").each((function(e,i){var a=s(i);switch(a.attr("type")){case"number":case"text":case"hidden":n.push(t+"="+a.val());break;case"radio":case"checkbox":i.checked&&n.push(t+"="+a.val())}}))}));var a=n.join("&");this.lastFetchParams!==a&&(this.lastFetchParams=null,this.updateJson(e+"?"+a),this.lastFetchParams=a)}},{key:"expand",value:function(e,t,i){if("true"!==t.attr("aria-expanded")){if(this.$selectWidget.addClass("select-widget--open"),this.$available.find(".spinner").attr("hidden",""),t.attr("aria-expanded",!0),this.$selectWidget.data("filter-endpoint")&&this.$selectWidget.data("filter-endpoint").length)try{this.fetchOptions()}catch(e){a.P.error(e)}var n=e.offset().top,r=n+e.outerHeight(),l=s(window).scrollTop(),o=l+s(window).height()-60,c=n-200>l&&!(r+200<o);i.toggleClass("available--top",c),i.removeAttr("hidden"),this.$search.get(0)!==document.activeElement&&this.$search.focus()}}}])&&o(t.prototype,n),l&&o(t,l),Object.defineProperty(t,"prototype",{writable:!1}),h}(n.wA)},76801:(e,t,i)=>{var n=i(79989),a=i(84328).includes,r=i(3689),s=i(87370);n({target:"Array",proto:!0,forced:r((function(){return!Array(1).includes()}))},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),s("includes")},43843:(e,t,i)=>{var n=i(79989),a=i(68844),r=i(42124),s=i(74684),l=i(34327),o=i(27413),c=a("".indexOf);n({target:"String",proto:!0,forced:!o("includes")},{includes:function(e){return!!~c(l(s(this)),l(r(e)),arguments.length>1?arguments[1]:void 0)}})}}]);