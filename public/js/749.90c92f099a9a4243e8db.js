"use strict";(self.webpackChunklinkspace=self.webpackChunklinkspace||[]).push([[749],{15749:(t,e,n)=>{n.r(e),n.d(e,{default:()=>y});n(52675),n(89463),n(2259),n(45700),n(28706),n(50113),n(23792),n(48598),n(62062),n(89572),n(2892),n(40875),n(26099),n(3362),n(60825),n(47764),n(62953);var a=n(28817),o=n(59888),i=(n(38781),function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}),r=n(17527),l=n(56197),c=n(74692),d=n(74692);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function s(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,f(a.key),a)}}function f(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e||"default");if("object"!=u(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==u(e)?e:e+""}function p(t,e,n){return e=b(e),function(t,e){if(e&&("object"===u(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,v()?Reflect.construct(e,n||[],b(t).constructor):e.apply(t,n))}function v(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(v=function(){return!!t})()}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}function m(t,e){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},m(t,e)}const y=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=p(this,e,[t])).context=void 0,n.wasInitialized||n.initCurvalModal(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}(e,t),a=e,f=[{key:"allowReinitialization",get:function(){return!0}}],(u=[{key:"initCurvalModal",value:function(){this.setupModal(),this.setupSubmit()}},{key:"curvalModalValidationSucceeded",value:function(t,e){var a=t.serialize(),l=t.data("modal-field-ids"),u=t.data("curval-id"),s=t.data("instance-name"),f=t.data("guid"),p=c("<input>").attr({type:"hidden",name:"field"+u,value:a}),v=c("div[data-column-id="+u+"]");if("noshow"===v.data("value-selector")){var b=this,m=c('<tr class="table-curval-item">',b.context);d.map(l,(function(n){var a=t.find('[data-column-id="'+n+'"]'),i=(0,o.B)(a);i=e["field"+n],i=c("<div />",b.context).text(i).html(),m.append(c('<td class="curval-inner-text">',b.context).append(i))}));var y=c('<td>\n          <button type="button" class="btn btn-small btn-link btn-js-curval-modal" data-toggle="modal" data-target="#curvalModal" data-layout-id="'.concat(u,'" data-instance-name="').concat(s,'">\n            <span class="btn__title">Edit</span>\n          </button>\n          </td>'),this.context),g=c('<td>\n          <button type="button" class="btn btn-small btn-delete btn-js-curval-remove">\n            <span class="btn__title">Remove</span>\n          </button>\n        </td>',this.context);m.append(y.append(p)).append(g),(0,r.VZ)(m[0]),f?c('input[data-guid="'+f+'"]',this.context).val(a).closest(".table-curval-item").replaceWith(m):(c("#curval_list_".concat(u)).find("tbody").prepend(m),c("#curval_list_".concat(u)).find(".dataTables_empty").hide())}else{var h=v.find(".select-widget").first(),w=h.hasClass("multi"),_=h.hasClass("select-widget--required"),k=v.find(".current"),S=k.find("[data-list-item]"),x=k.find(".search"),j=v.find(".available");w||(S.attr("hidden",""),j.find("li input").prop("checked",!1));var C=d.map(l,(function(t){var n=e["field"+t];return c("<div />").text(n).html()})).join(", ");f=i();var O="field".concat(u,"_").concat(f),M=w?'<button class="close select-widget-value__delete" aria-hidden="true" aria-label="delete" title="delete" tabindex="-1">&times;</button>':"";x.before('<li data-list-item="'.concat(O,'"><span class="widget-value__value">').concat(C,"</span>").concat(M,"</li>")).before(" ");var P=w?"checkbox":"radio",V=_?'required="required" aria-required="true" aria-errormessage="'.concat(h.attr("id"),'-err"'):"";j.append('<li class="answer" role="option">\n        <div class="control">\n          <div class="'.concat(w?"checkbox":"radio-group__option",'">\n            <input ').concat(V,' id="').concat(O,'" name="field').concat(u,'" type="').concat(P,'" value="').concat(a,'" class="').concat(w?"":"radio-group__input",'" checked aria-labelledby="').concat(O,'_label">\n            <label id="').concat(O,'_label" for="').concat(O,'" class="').concat(w?"":"radio-group__label",'">\n              <span>').concat(C,'</span>\n            </label>\n          </div>\n        </div>\n        <div class="details">\n          <button type="button" class="btn btn-small btn-danger btn-js-curval-remove">\n            <span class="btn__title">Remove</span>\n          </button>\n        </div>\n      </li>')),this.updateWidgetState(h,w,_),(0,r.VZ)(v[0]),n.e(732).then(n.bind(n,53163)).then((function(t){new(0,t.default)(h[0])}))}c(this.element).modal("hide")}},{key:"updateWidgetState",value:function(t,e,n){var a=t.find(".current"),o=a.children("[data-list-item]:not([hidden])");a.toggleClass("empty",0===o.length),n&&(e?(0,l.dg)(t):(0,l.Px)(t))}},{key:"curvalModalValidationFailed",value:function(t,e){t.find(".alert").text(e).removeAttr("hidden"),t.parents(".modal-content").get(0).scrollIntoView(),t.find("button[type=submit]").prop("disabled",!1)}},{key:"setupModal",value:function(){var t=this;this.el.on("show.bs.modal",(function(e){var n,a=e.relatedTarget,o=c(a).data("layout-id"),l=c(a).data("instance-name"),d=c(a).data("current-id"),u=c(a).closest(".table-curval-item").find("input[name=field".concat(o,"]")),s=u.val(),f=u.length?"edit":"add",p=c(a).closest(".form-group");p.find(".table-curval-group").length?t.context=p.find(".table-curval-group"):p.find(".select-widget").length&&(t.context=p.find(".select-widget")),"edit"===f&&((n=u.data("guid"))||(n=i(),u.attr("data-guid",n)));var v=c(t.element),b=t;v.find(".modal-body").text("Loading...");var m=d?"/record/".concat(d):"/".concat(l,"/record/");v.find(".modal-body").load(t.getURL(m,o,s,p),(function(){"edit"===f&&v.find("form").data("guid",n),(0,r.VZ)(b.element)})),v.on("focus",".datepicker",(function(){c(this).datepicker({format:v.attr("data-dateformat-datepicker"),autoclose:!0})})),v.off("hide.bs.modal").on("hide.bs.modal",(function(){return confirm("Closing this dialogue will cancel any work. Are you sure you want to do so?")}))}))}},{key:"getURL",value:function(t,e,n,a){return window.siteConfig&&window.siteConfig.urls.curvalTableForm&&window.siteConfig.urls.curvalSelectWidgetForm?"noshow"===a.data("value-selector")?window.siteConfig.urls.curvalTableForm:window.siteConfig.urls.curvalSelectWidgetForm:"".concat(t,"?include_draft&modal=").concat(e,"&").concat(n)}},{key:"setupSubmit",value:function(){var t=this;c(this.element).on("submit",".curval-edit-form",(function(e){t.el.off("hide.bs.modal"),e.preventDefault();var n=c(this),a=n.serialize();n.addClass("edit-form--validating"),n.find(".alert").attr("hidden","");var o=window.siteConfig&&window.siteConfig.curvalData;o?t.curvalModalValidationSucceeded(n,o.values):c.post(n.attr("action")+"?validate&include_draft&source="+n.data("curval-id"),a,(function(e){if(0===e.error)t.curvalModalValidationSucceeded(n,e.values);else{var a=1===e.error?e.message:"Oops! Something went wrong.";t.curvalModalValidationFailed(n,a)}}),"json").fail((function(e,a,o){var i="Oops! Something went wrong: ".concat(a,": ").concat(o);t.curvalModalValidationFailed(n,i)})).always((function(){n.removeClass("edit-form--validating")}))}))}}])&&s(a.prototype,u),f&&s(a,f),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,u,f}(a.A)}}]);