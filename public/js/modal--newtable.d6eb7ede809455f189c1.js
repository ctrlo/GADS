"use strict";(self.webpackChunklinkspace=self.webpackChunklinkspace||[]).push([[60],{4148:(t,e,i)=>{i.r(e),i.d(e,{default:()=>j});i(25728),i(60228),i(32320),i(69358),i(34284),i(34338),i(59749),i(86544),i(36585),i(47522),i(38077),i(48324),i(28436),i(88052),i(76034),i(30050),i(32349),i(81919),i(69373),i(59903),i(79288),i(84254),i(752),i(21694),i(76265),i(89730),i(12826),i(77049),i(64043),i(7409);var n=i(38042),r=i(19755),a=function(t,e){e.DataTable().row.add(t).draw()},o=function(t,e,i){e.find("tbody > tr").each((function(n,a){r(a).has("button[data-tempid=".concat(i,"]")).length&&e.DataTable().row(n).data(t).draw()}))},c=function(t){t.DataTable().clear().draw()},s=i(79475),l=i(86367),d=i(19755);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,a,o,c=[],s=!0,l=!1;try{if(a=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;s=!1}else for(;!(s=(n=a.call(i)).done)&&(c.push(n.value),c.length!==e);s=!0);}catch(t){l=!0,r=t}finally{try{if(!s&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(l)throw r}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return p(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(r=n.key,a=void 0,a=function(t,e){if("object"!==u(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===u(a)?a:String(a)),n)}var r,a}function b(){return b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=v(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}},b.apply(this,arguments)}function m(t,e){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},m(t,e)}function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=v(t);if(e){var r=v(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return function(t,e){if(e&&("object"===u(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,i)}}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}const j=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}(u,t);var e,i,n,r=y(u);function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=r.call(this,t)).el=d(e.element),e.json={},e.fieldOptions=e.el.find(".modal-body .field-options"),e.topicsTable=e.el.find("#topics"),e.fieldsTable=e.el.find("#fields"),e.selectTopic=e.el.find(".modal-body .select--js-topic")[0],e.selectTopicComponent=new l.Z(e.selectTopic),e.currentFieldObject={},e.currentTopicObject={},e.initNewTable(e.el),e}return e=u,(i=[{key:"initNewTable",value:function(t){var e=this.el.find(".modal-body .btn-js-create-topic"),i=this.el.find(".modal-body .btn-js-create-field");e.on("click",(function(t){s.o.activate(4,!0)})),i.on("click",(function(t){s.o.activate(7,!0)})),this.fieldOptions.addClass("hidden"),this.setupDataObject()}},{key:"setupDataObject",value:function(){this.json={table_permissions:[],topics:[],fields:[]}}},{key:"addFieldsToObject",value:function(t,e){return t.each((function(t,i){d(i).val()&&("checkbox"==d(i).prop("type")?d(i).prop("checked")?e[d(i).attr("name")]=!0:e[d(i).attr("name")]=!1:"topic_tempid"===d(i).attr("name")?e[d(i).attr("name")]=parseInt(d(i).val()):e[d(i).attr("name")]=d(i).val())})),e}},{key:"addTopic",value:function(t){var e=this,i=t.find("input, textarea");if(0===Object.keys(this.currentTopicObject).length){var n={tempId:this.uniqueID()};n=this.addFieldsToObject(i,n),this.currentTopicObject=n,this.json.topics.push(n),this.selectTopicComponent.addOption(n.name,n.tempId);var r=['<button class="btn btn-link btn-js-edit-topic" type="button" data-tempid="'.concat(n.tempId,'">').concat(n.name,"</button>"),n.description||"",n.expanded,""];a(r,this.topicsTable),this.addHandlerToEditItemButton("topic")}else{var c=this.json.topics.find((function(t){return t.tempId===e.currentTopicObject.tempId}));i.each((function(t,e){d(e).val()&&(c[d(e).attr("name")]=d(e).val())}));var s=['<button class="btn btn-link btn-js-edit-topic" type="button" data-tempid="'.concat(this.currentTopicObject.tempId,'">').concat(this.currentTopicObject.name,"</button>"),this.currentTopicObject.description||"",this.currentTopicObject.expanded,""];o(s,this.topicsTable,this.currentTopicObject.tempId),this.selectTopicComponent.updateOption(this.currentTopicObject.name,this.currentTopicObject.tempId),this.addHandlerToEditItemButton("topic")}}},{key:"fillFields",value:function(t,e){for(var i=0,n=Object.entries(e);i<n.length;i++){var r=f(n[i],2),a=r[0],o=r[1],c=t.find("[name=".concat(a,"]"));c&&("checkbox"===c.prop("type")&&!0===o?c.prop("checked",!0):"hidden"===c.prop("type")?(c.val(o),c.trigger("change")):(c.val(o),c.trigger("blur")))}}},{key:"editTopic",value:function(t,e){this.currentTopicObject=t,this.fillFields(d(e),t)}},{key:"editField",value:function(t,e){var i=this;this.currentFieldObject=t,s.o.clear([8,9]),this.fillFields(d(e),t);var n=t.field_type,r=b(v(u.prototype),"getFrameByNumber",this).call(this,8),a=d(r).find("[id=field_type_".concat(n,"]"));this.fillFields(a,t.field_type_settings);var o=t.custom_field_permissions,c=b(v(u.prototype),"getFrameByNumber",this).call(this,9);o.forEach((function(t){var e=t.group_id,n=d(c).find("tr[data-group-id=".concat(e,"]"));i.fillFields(n,t.permissions)}))}},{key:"removeNode",value:function(t,e){return e.filter((function(e){return e.tempId!==t}))}},{key:"addHandlerToEditItemButton",value:function(t){var e=this.el.find(".modal-body .btn-js-edit-".concat(t));e.off("click");var i="topic"===t?4:7;e.each((function(t,e){var n=d(e).data("tempid");d(e).on("click",(function(t){s.o.activate(i,!0,n)}))}))}},{key:"uniqueID",value:function(){return Math.floor(Math.random()*Date.now())}},{key:"addField",value:function(t){var e=this,i=t.find("input, textarea");if(0===Object.keys(this.currentFieldObject).length){var n={tempId:this.uniqueID(),custom_field_permissions:[],field_type_settings:{}};n=this.addFieldsToObject(i,n),this.currentFieldObject=n,this.json.fields.push(n);var r=['<button class="btn btn-link btn-js-edit-field" type="button" data-tempid="'.concat(n.tempId,'">').concat(n.name,"</button>"),n.name,n.topic||"",n["field-type"],""];a(r,this.fieldsTable),this.addHandlerToEditItemButton("field")}else{var c=this.json.fields.find((function(t){return t.tempId===e.currentFieldObject.tempId}));i.each((function(t,e){d(e).val()&&(c[d(e).attr("name")]=d(e).val())}));var s=['<button class="btn btn-link btn-js-edit-field" type="button" data-tempid="'.concat(this.currentFieldObject.tempId,'">').concat(this.currentFieldObject.name,"</button>"),this.currentFieldObject.name,this.currentFieldObject.topic||"",this.currentFieldObject["field-type"],""];o(s,this.fieldsTable,this.currentFieldObject.tempId),this.addHandlerToEditItemButton("field")}}},{key:"addFieldTypeSettings",value:function(t){var e=this,i=t.find("[id^=field_type_].select-reveal__instance:visible"),n=i.find("input, textarea"),r=this.json.fields.find((function(t){return t.tempId===e.currentFieldObject.tempId}));switch(i.attr("id")){case"field_type_enum":var a=i.find('input[name="ordering"]'),o=i.find(".sortable input"),c={dropdown_values:[],ordering:a.val()};o.each((function(t,e){var i={};i[d(e).attr("name")]=d(e).val(),c.dropdown_values.push(i)})),r.field_type_settings=c;break;case"field_type_tree":var s=i.find(".tree-widget-container"),l={data:{},dataJson:{}};if(s.length){var u=s.jstree(!0).get_json("#",{flat:!1}),f=(JSON.stringify(u),s.data().jstree._model.data);l.data=f,l.dataJson=u}l=this.addFieldsToObject(n,l),r.field_type_settings=l;break;case"field_type_curval":var p=i.find('input[name="curval_field_ids"]:visible'),h=i.find('input:not([name="curval_field_ids"]), textarea'),b={curval_field_ids:[]};p.each((function(t,e){d(e).val()&&b.curval_field_ids.push(d(e).val())})),b=this.addFieldsToObject(h,b),r.field_type_settings=b;break;default:var m={};m=this.addFieldsToObject(n,m),r.field_type_settings=m}}},{key:"addTable",value:function(t){var e=t.find("input, textarea"),i=this.el.find(".modal-title"),n=this;e.each((function(t,e){d(e).val()&&(n.json[d(e).attr("name")]=d(e).val())})),this.json.name&&i.html("Table setup | ".concat(this.json.name))}},{key:"addCustomFieldPermissions",value:function(t){var e=this,i=this,n=t.find("#custom_field_permissions_table").DataTable().rows(),r=i.json.fields.find((function(t){return t.tempId===e.currentFieldObject.tempId}));r.custom_field_permissions=[],n.every((function(t){var e=this.nodes()[0],n=e.dataset.groupId,a=d(e).find("td")[0].innerHTML.trim(),o=d(e).find("input"),c={group_id:n,group_name:a,permissions:{}};c.permissions=i.addFieldsToObject(o,c.permissions),r.custom_field_permissions.push(c)}))}},{key:"addTablePermissions",value:function(t){var e=this,i=t.find(".card--expandable"),n=this;i.each((function(t,i){var r=d(i).closest(".permission-group"),a=r&&void 0!==r.data("group-id")?r.data("group-id"):"",o=d(i).find(".card__subtitle")[0].innerHTML.trim(),c=d(i).find("fieldset"),s={group_id:a,group_name:o,records:{},views:{},fields:{}};c.each((function(t,i){var n=d(i).data("name"),r=d(i).find("input");s[n]=e.addFieldsToObject(r,s[n])})),n.json.table_permissions.push(s)}))}},{key:"handleNext",value:function(t){switch(b(v(u.prototype),"handleNext",this).call(this),t.data("config").item){case"topic":this.addTopic(t);break;case"field":this.addField(t);break;case"field type settings":this.addFieldTypeSettings(t),this.recalculateDatatableColumnWidths(d("#custom_field_permissions_table"));break;case"custom field permissions":this.addCustomFieldPermissions(t);break;case"table":this.addTable(t);break;case"table permissions":this.addTablePermissions(t);break;default:var e=t.find("input, textarea");this.addFieldsToObject(e,this.json)}}},{key:"recalculateDatatableColumnWidths",value:function(t){t.DataTable().columns.adjust()}},{key:"handleBack",value:function(t){b(v(u.prototype),"handleBack",this).call(this)}},{key:"handleSave",value:function(){s.o.upload(this.json)}},{key:"handleUpdate",value:function(t){"topic"===t.data("config").item?(this.addTopic(t),this.currentTopicObject={}):"field"===t.data("config").item&&(this.addField(t),this.currentFieldObject={})}},{key:"handleActivate",value:function(t,e,i){if(b(v(u.prototype),"handleActivate",this).call(this,t,e),7===t&&i){var n=b(v(u.prototype),"getFrameByNumber",this).call(this,t),r=this.json.fields.find((function(t){return t.tempId===i}));this.editField(r,n)}else if(7===t&&e)this.currentFieldObject={},s.o.clear([8,9]);else if(4===t&&i){var a=b(v(u.prototype),"getFrameByNumber",this).call(this,t),o=this.json.topics.find((function(t){return t.tempId===i}));this.editTopic(o,a)}else 4===t&&e&&(this.currentTopicObject={});b(v(u.prototype),"validateFrame",this).call(this)}},{key:"handleClose",value:function(){var t=this;this.el.find(".collapse").collapse("hide"),this.topicsTable&&c(this.topicsTable),this.fieldsTable&&c(this.fieldsTable),this.selectTopicComponent.options.each((function(e,i){t.selectTopicComponent.removeOption(parseInt(i.dataset.value))})),this.setupDataObject(),this.currentFieldObject={},this.currentTopicObject={},b(v(u.prototype),"handleClose",this).call(this)}}])&&h(e.prototype,i),n&&h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(n.Z)},75984:(t,e,i)=>{var n=i(41236).PROPER,r=i(3689),a=i(86350);t.exports=function(t){return r((function(){return!!a[t]()||"​᠎"!=="​᠎"[t]()||n&&a[t].name!==t}))}},28436:(t,e,i)=>{var n=i(79989),r=i(61435).trim;n({target:"String",proto:!0,forced:i(75984)("trim")},{trim:function(){return r(this)}})}}]);