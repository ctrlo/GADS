"use strict";(self.webpackChunklinkspace=self.webpackChunklinkspace||[]).push([[773,1],{84030:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var n=a(17527),l=(a(65580),a(76124),a(86001),a(84276),a(22224)),s=a(96688),i=a(47440),r=a(74692);class DataTableComponent extends n.uA{constructor(e){super(e),this.el=r(this.element),this.hasCheckboxes=this.el.hasClass("table-selectable"),this.hasClearState=this.el.hasClass("table-clear-state"),this.forceButtons=this.el.hasClass("table-force-buttons"),this.searchParams=new URLSearchParams(window.location.search),this.base_url=this.el.data("href")?this.el.data("href"):void 0,this.isFullScreen=!1,this.initTable()}initTable(){if(this.hasClearState){this.clearTableStateForPage();const e=new URL(window.location.href);e.searchParams.delete("table_clear_state");const t=e.toString();return void window.location.replace(t.endsWith("?")?t.slice(0,-1):t)}const e=this.getConf(),{columns:t}=e;this.columns=t,this.el.DataTable(e),this.initializingTable=!0,r(".dt-column-order").remove(),this.hasCheckboxes&&this.addSelectAllCheckbox(),this.el.hasClass("table-account-requests")&&(this.modal=r.find("#userModal"),this.initClickableTable(),this.el.on("draw.dt",(()=>{this.initClickableTable()}))),(0,i.bindToggleTableClickHandlers)(this.el),r(this.el).on("childRow.dt",((e,t,n)=>{const s=r(n.child()),i=s.find(".record-popup");(0,l.o)(s),i&&a.e(393).then(a.bind(a,89429)).then((({default:e})=>{i.each(((t,a)=>{new e(a)}))}))}))}clearTableStateForPage(){for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);if(!t.startsWith("DataTables"))continue;const a=t.split("/");!a||a.length<=1||-1!==window.location.href.indexOf("/"+a.slice(1).join("/"))&&localStorage.removeItem(t)}}initClickableTable(){const e=this.el.find("tbody td .link");e.off("click"),e.off("focus"),e.off("blur"),e.on("click",(e=>{this.handleClick(e)})),e.on("focus",(e=>{this.toggleFocus(e,!0)})),e.on("blur",(e=>{this.toggleFocus(e,!1)}))}toggleFocus(e,t){const a=r(e.target).closest("tr");t?a.addClass("tr--focus"):a.removeClass("tr--focus")}handleClick(e){const t=r(e.target).closest("tr");e.preventDefault(),this.fillModalData(t),r(this.modal).modal("show")}fillModalData(e){const t=r(this.modal).find("input, textarea"),a=r(this.modal).find(".btn-js-reject-request-send"),n=parseInt(r(e).find("td[data-id]").data("id"),10);n&&(r(this.modal).data("config").id=n),a&&n&&!isNaN(n)&&a.val(n),t.each(((t,a)=>{const n=r(a).attr("name"),l=r(e).find(`td[data-${n}]`).data(n);if(n&&l){const e=r(a);e.data("original-value",l),e.is(":radio, :checkbox")?e.val()==l&&e.trigger("click"):(e.data("original-value",l),e.trigger("change"),e.val(l))}}))}getCheckboxElement(e,t){return`<div class='checkbox'><input id='dt_checkbox_${e}' type='checkbox' /><label for='dt_checkbox_${e}'><span>${t}</span></label></div>`}addSelectAllCheckbox(){const e=this.el.find("thead th.check"),t=this.el.find("tbody .check .checkbox input");e.length&&e.html(this.getCheckboxElement("all","Select all")),this.checkSelectAll(t,e.find("input")),t.on("click",(()=>{this.checkSelectAll(t,e.find("input"))})),e.find("input").on("click",(e=>{const a=r(e.target);r(a).is(":checked")?this.checkAllCheckboxes(t,!0):this.checkAllCheckboxes(t,!1)}))}checkAllCheckboxes(e,t){t?e.prop("checked",!0):e.prop("checked",!1)}checkSelectAll(e,t){let a=!0;e.each(((e,n)=>{n.checked||(t.prop("checked",!1),a=!1)})),a&&t.prop("checked",!0)}addSortButton(e,t,a){const n=r(t.header()),l=r(`\n      <button class="data-table__sort" type="button">\n        <span>${a}</span>\n        <span class="btn btn-sort">\n          <span>Sort</span>\n        </span>\n      </button>`);n.off().find(".data-table__header-wrapper").html(l),e.order.listener(l,t.index())}toggleFilter(e){const t=r(e.header());""!==e.search()?(t.find(".data-table__header-wrapper").addClass("filter"),t.find(".data-table__clear").show()):(t.find(".data-table__header-wrapper").removeClass("filter"),t.find(".data-table__clear").hide())}async addSearchDropdown(e,t,n){const l=r(e.header()),s=l.text().trim(),i=e.search(),o=this,{context:d}=e,{oAjaxData:c}=d[0],{columns:h}=c,u=h[e.index()].name,b=this.columns[e.index()],p=r(`<div class='data-table__search'>\n        <button\n          class='btn btn-search dropdown-toggle'\n          id='search-toggle-${n}'\n          type='button'\n          data-toggle='dropdown'\n          aria-expanded='false'\n          data-boundary='viewport'\n          data-reference='parent'\n          data-target="[data-ddl='ddl_${n}']"\n          data-focus="[data-ddl='ddl_${n}']"\n        >\n          <span>Search in ${s}</span>\n        </button>\n        <div class='dropdown-menu p-2' aria-labelledby='search-toggle-${n}'>\n          <label>\n            <div class='input'>\n            </div>\n          </label>\n          <button type='button' class='btn btn-link btn-small data-table__clear hidden'>\n            <span>Clear filter</span>\n          </button>\n        </div>\n      </div>`),f=r(`<input class='form-control form-control-sm' type='text' placeholder='Search' value='${i}'/>`);if(f.appendTo(r(".input",p)),b.typeahead_use_id){if(f.after('<input type="hidden" class="search">'),i){const e=await fetch(this.getApiEndpoint(u)+i+"&use_id=1",{method:"POST",data:{csrf_token:r("body").data("csrf")}}),t=await e.json();t.error||0!=t.records.length&&(f.val(t.records[0].label),r("input.search",p).val(t.records[0].id).trigger("change"))}}else r("input",p).addClass("search");l.find(".data-table__header-wrapper").prepend(p),this.toggleFilter(e),b&&b.typeahead&&Promise.all([a.e(760),a.e(202)]).then(a.bind(a,34789)).then((({default:e})=>{(new e).withAjaxSource(this.getApiEndpoint(u)).withMethod("POST").withData({csrf_token:r("body").data("csrf")}).withInput(r("input",l)).withAppendQuery().withDefaultMapper().withName(u.replace(/\s+/g,"")+"Search").withCallback((e=>{b.typeahead_use_id?(f.val(e.name),r("input.search",p).val(e.id).trigger("change")):r("input",p).addClass("search").val(e.name).trigger("change")})).build()})),r("input.search",l).on("change",(function(a){let n=this.value||a.target.value;e.search()!==n&&e.search(n).draw(),o.toggleFilter(e),o.searchParams.has(t)?o.searchParams.set(t,this.value):o.searchParams.append(t,this.value);const l=`${window.location.href.split("?")[0]}?${o.searchParams.toString()}`;window.history.replaceState(null,"",l)})),r(".data-table__clear",l).on("click",(function(){if(r(this).closest(".dropdown-menu").find("input").val(""),e.search("").draw(),o.toggleFilter(e),o.searchParams.has(t)){o.searchParams.delete(t);let e=`${window.location.href.split("?")[0]}`;void 0!==o.searchParams.entries().next().value&&(e+=`?${o.searchParams.toString()}`),window.history.replaceState(null,"",e)}}))}getApiEndpoint(e){return`/${r("body").data("layout-identifier")}/match/layout/${e}?q=`}encodeHTMLEntities(e){return r("<textarea/>").text(e).html()}decodeHTMLEntities(e){return r("<textarea/>").html(e).text()}renderMoreLess(e,t){return e.toString().length>50?`<div class="more-less" data-column="${t}">\n          ${e}\n        </div>`:e}renderDefault(e){let t="";return e.values&&e.values.length?(e.values.forEach(((a,n)=>{t+=this.encodeHTMLEntities(a),t+=e.values.length>n+1?", ":""})),this.renderMoreLess(t,e.name)):t}renderId(e){let t="";const a=e.values[0];return a?(e.parent_id&&(t=`<span title="Child record with parent record ${e.parent_id}">${e.parent_id} &#8594;</span> `),t+`<a href="${this.base_url}/${a}">${a}</a>`):t}renderPerson(e){let t="";return e.values.length?(e.values.forEach((e=>{if(e.details.length){let a="<div>";e.details.forEach((e=>{const t=this.encodeHTMLEntities(e.value);"email"===e.type?a+=`<p>E-mail: <a href="mailto:${t}">${t}</a></p>`:a+=`<p>${this.encodeHTMLEntities(e.definition)}: ${t}</p>`})),a+="</div>",t+=`<div class="position-relative">\n            <button class="btn btn-small btn-inverted btn-info trigger" aria-expanded="false" type="button">\n              ${this.encodeHTMLEntities(e.text)}\n              <span class="invisible">contact details</span>\n            </button>\n            <div class="person contact-details expandable popover card card--secundary">\n              ${a}\n            </div>\n          </div>`}})),t):t}renderFile(e){let t="";return e.values.length?(e.values.forEach((e=>{t+=`<a href="/file/${e.id}">`,e.mimetype.match("^image/")?t+=`<img class="autosize" src="/file/${e.id}"></img>`:t+=`${this.encodeHTMLEntities(e.name)}<br>`,t+="</a>"})),t):t}renderRag(e){let t="";const a={a_grey:"undefined",b_red:"danger",b_attention:"attention",c_amber:"warning",c_yellow:"advisory",d_green:"success",d_blue:"complete",e_purple:"unexpected"};if(e.values.length){t=a[e.values[0]]||"blank"}else t="blank";return`<span class="rag rag--${t}" title="${r("#rag_"+t+"_meaning").text()}" aria-labelledby="rag_${t}_meaning"><span>âœ—</span></span>`}renderCurCommon(e){let t="";return 0===e.values.length?t:(t=this.renderCurCommonTable(e),this.renderMoreLess(t,e.name))}renderCurCommonTable(e){let t="";return 0===e.values.length||0===e.values[0].fields.length||(t+='<table class="table-curcommon">',e.values.forEach((e=>{t+=`<tr role="button" tabindex="0" class="link record-popup" data-record-id="${e.record_id}"`,e.version_id&&(t+=`data-version-id="${e.version_id}"`),t+=">",e.status&&(t+=`<td><em>${e.status}:</em></td>`),e.fields.forEach((e=>{t+=`<td class="${e.type}">${this.renderDataType(e)}</td>`})),t+="</tr>"})),t+="</table>",e.limit_rows&&e.values.length>=e.limit_rows&&(t+=`<p><em>(showing maximum ${e.limit_rows} rows.\n          <a href="/${e.parent_layout_identifier}/data?curval_record_id=${e.curval_record_id}&curval_layout_id=${e.column_id}">view all</a>)</em>\n        </p>`)),t}renderDataType(e){switch(e.type){case"id":return this.renderId(e);case"person":case"createdby":return this.renderPerson(e);case"curval":case"autocur":case"filval":return this.renderCurCommon(e);case"file":return this.renderFile(e);case"rag":return this.renderRag(e);default:return this.renderDefault(e)}}renderData(e,t,a){const n=t[a?a.settings.oAjaxData.columns[a.col].name:""];return"object"!=typeof n?"":this.renderDataType(n)}getConf(e=void 0){const t=this.el.data("config");let a={};if("string"==typeof t?a=JSON.parse(atob(t)):"object"==typeof t&&(a=t),e)for(const t in e)a[t]=e[t];a.columns.forEach((e=>{e.orderable=1===e.orderable})),a.serverSide&&a.columns.forEach((e=>{e.render=(e,t,a,n)=>this.renderData(t,a,n)}));const n=this;return a.initComplete=(e,t)=>{const l=this.el,s=l.DataTable();this.json=t||void 0,(this.initializingTable||a.reinitialize)&&(s.columns().every((function(t){const i=this,o=r(i.header()),d=o.html();if(o.html(`<div class='data-table__header-wrapper position-relative ${i.search()?"filter":""}' data-ddl='ddl_${t}'>${d}</div>`),(o.hasClass("dt-orderable-asc")||o.hasClass("dt-orderable-desc"))&&n.addSortButton(s,i,d),a.serverSide&&l.hasClass("table-search")){const a=e.oAjaxData.columns[t].name;n.searchParams.has(a)&&i.search(n.searchParams.get(a)).draw(),n.addSearchDropdown(i,a,t)}return!0})),this.el.hasClass("collapsed")||this.el.closest(".dataTables_wrapper").find(".btn-toggle-off").length&&this.el.closest(".dataTables_wrapper").find(".dataTables_toggle_full_width").hide(),this.initializingTable=!1)},a.footerCallback=function(){const e=this.api(),t=e.ajax&&e.ajax.json()&&e.ajax.json().aggregate;if(t){const a=e.settings()[0].oAjaxData.columns;e.columns().every((function(){const e=this.index(),{name:l}=a[e];return t[l]&&r(this.footer()).html(n.renderDataType(t[l])),!0}))}},a.drawCallback=()=>{s.B.reinitialize(),this.el.DataTable().button(0).enable(),this.bindClickHandlersAfterDraw(a)},a.buttons=[{text:"Full screen",enabled:!1,attr:{id:"full-screen-btn"},className:"btn btn-small btn-toggle-off",action:e=>{this.toggleFullScreenMode(e)}}],a}toggleFullScreenMode(e){const t=document.querySelector("table.data-table"),a=r(t);if(a&&r.fn.dataTable.isDataTable(a)&&a.DataTable().destroy(),this.isFullScreen){const e=document.querySelector(".content-block__main-content");if(!e)return void console.warn("Failed to close full screen; missing main content");e.appendChild(t),a&&!r.fn.dataTable.isDataTable(a)&&a.DataTable(this.getConf({reinitialize:!0})),document.querySelector("#table-modal").remove(),r(document).off("keyup")}else{const n=document.createElement("div");n.id="table-modal",n.classList.add("table-modal"),n.classList.add("data-table__container--scrollable"),n.append(t),document.body.appendChild(n),a&&!r.fn.dataTable.isDataTable(a)&&a.DataTable(this.getConf({responsive:!1,reinitialize:!0})),r(document).on("keyup",(t=>{"Escape"===t.key&&this.toggleFullScreenMode(e)}))}this.isFullScreen=!this.isFullScreen,r("#full-screen-btn").removeClass(this.isFullScreen?"btn-toggle-off":"btn-toggle"),r("#full-screen-btn").addClass(this.isFullScreen?"btn-toggle":"btn-toggle-off")}bindClickHandlersAfterDraw(e){const t=this.el,a=t.DataTable().rows({page:"current"}).data();if(a&&this.base_url&&r(t).find("> tbody > tr").each(((e,t)=>{const n=a[e]?a[e]:void 0;if(n){const e=n._id?`${this.base_url}/${n._id}`:`?${n._count.url}`;r(t).find('td:not(".dtr-control")').on("click",(t=>{t.target.closest(".record-popup")||(window.location=e)}))}})),e.serverSide){const e=r(t).find(":not(.more-less) > .trigger[aria-expanded]");e.off("click",l.n),e.on("click",l.n),(0,n.VZ)(this.element)}}}const o=DataTableComponent},47440:(e,t,a)=>{a.r(t),a.d(t,{bindToggleTableClickHandlers:()=>l,toggleRow:()=>s,toggleRowInTable:()=>i});var n=a(74692);const l=e=>{if(e.hasClass("table-toggle")){const t=e.find("tbody tr");t.off("click",s),t.on("click",s);const a=e.find("tbody btn");a.off("click",s),a.on("click",s)}},s=e=>{e.preventDefault();const t=n(e.target).closest("tr")[0],a=n(e.target).closest("table"),l=a.data("destination");i(t,a,l)},i=(e,t,a,l=null)=>{const s=n(a);if(void 0===s)return void console.error(`Failed to toggle row; missing 'toggle-destination' data attribute for table '${t.attr("id")}'`);const i=e.dataset.toggleFieldIdSelector+e.dataset.toggleFieldId,r=s.DataTable().row(i);if(0==r.length)return void console.error(`Failed to toggle row; missing row ${i} in table ${a}`);const o=e.querySelector("input");o&&("boolean"==typeof l?o.checked=!l:o.checked^=1);const d=r.node().querySelector("input");d&&("boolean"==typeof l?d.checked=l:d.checked^=1);const c=r.node().dataset.fieldIsToggled;c&&(r.node().dataset.fieldIsToggled="boolean"==typeof l?l.toString():"true"==c?"false":"true");const h=e.dataset.fieldIsToggled;void 0!==h&&(e.dataset.fieldIsToggled="boolean"==typeof l?!l.toString():"true"==h?"false":"true")}}}]);