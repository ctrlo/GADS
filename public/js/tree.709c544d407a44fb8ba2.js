"use strict";(self.webpackChunklinkspace=self.webpackChunklinkspace||[]).push([[623],{20298:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var i=n(17527),s=(n(91460),n(56197)),r=n(74692);class TreeComponent extends i.uA{constructor(e){super(e),this.el=r(this.element),this.isConfTree=this.el.hasClass("tree--config"),this.el.find(".tree-widget-container").length>0&&(this.multiValue=this.el.closest(".linkspace-field").data("is-multivalue"),this.noInitialData=this.el.data("no-initial-data"),this.$treeContainer=this.el.find(".tree-widget-container"),this.id=this.$treeContainer.data("column-id"),this.field=this.$treeContainer.data("field"),this.endNodeOnly=this.$treeContainer.data("end-node-only"),this.initialized=!1,this.initTree())}initTree(){const e=this.$treeContainer.data("ids-as-params"),t={core:{check_callback:!0,force_text:!0,themes:{stripes:!1},worker:!1,data:this.noInitialData?null:this.getData(this.id,e)},plugins:[]};if(this.multiValue?t.plugins.push("checkbox"):t.core.multiple=!1,this.isConfTree||this.$treeContainer.on("changed.jstree",((e,t)=>this.handleChange(e,t))),!this.multiValue){let e;this.$treeContainer.on("click",".jstree-clicked",(()=>{if(!e)throw"Not a node!";this.$treeContainer.jstree(!0).deselect_node(e)})),this.$treeContainer.on("select_node.jstree",((t,n)=>{e&&n.node.id==e.id?(this.$treeContainer.jstree(!0).deselect_node(n.node),e=null):(e=n.node,this.handleSelect(t,n))}))}this.$treeContainer.on("ready.jstree",(()=>{(0,s.pT)(this.el),this.initialized=!0})),this.$treeContainer.on("changed.jstree",(()=>(0,s.Pc)(this.el))),this.$treeContainer.jstree(t),this.setupJStreeButtons(this.$treeContainer),this.$treeContainer.jstree(!0).settings.checkbox.cascade="undetermined"}getData(e,t){const n=window.siteConfig&&window.siteConfig.urls.treeApi,i=r("body").data("layout-identifier");return{url:function(){return n||`/${i}/tree${(new Date).getTime()}/${e}?${t}`},data:function(e){return{id:e.id}},dataType:"json"}}handleSelect(e,t){0!=t.node.children.length&&(this.endNodeOnly?(this.$treeContainer.jstree(!0).deselect_node(t.node),this.$treeContainer.jstree(!0).toggle_node(t.node)):this.multiValue&&this.$treeContainer.jstree(!0).open_node(t.node))}handleChange(e,t){this.$treeContainer.nextAll(".selected-tree-value").remove();const n=this.$treeContainer.jstree("get_selected",!0);r.each(n,((e,n)=>{const i=r(`<input type="hidden" class="selected-tree-value" name="${this.field}" value="${n.id}" />`).appendTo(this.$treeContainer.closest(".tree")),s=t.instance.get_path(n,"#");i.data("text-value",s)})),0==n.length&&this.$treeContainer.after(`<input type="hidden" class="selected-tree-value" name="${this.field}" value="" />`),this.initialized&&this.$treeContainer.trigger("change")}setupJStreeButtons(e){const t=this.el.find(".btn-js-tree-expand"),n=this.el.find(".btn-js-tree-collapse"),i=this.el.find(".btn-js-tree-reload"),s=this.el.find(".btn-js-tree-add"),r=this.el.find(".btn-js-tree-rename"),a=this.el.find(".btn-js-tree-delete");t.on("click",(()=>{e.jstree("open_all")})),n.on("click",(()=>{e.jstree("close_all")})),i.on("click",(()=>{e.jstree("refresh")})),s.on("click",(()=>{this.handleAdd()})),r.on("click",(()=>{this.handleRename()})),a.on("click",(()=>{this.handleDelete()}))}handleAdd(){const e=this.$treeContainer.jstree(!0);let t=e.get_selected();t=t.length?t[0]:"#",t=e.create_node(t,{type:"file"}),t&&e.edit(t)}handleDelete(){const e=this.$treeContainer.jstree(!0);let t=e.get_selected();if(!t.length)return!1;e.delete_node(t)}handleRename(){const e=this.$treeContainer.jstree(!0);let t=e.get_selected();if(!t.length)return!1;t=t[0],e.edit(t)}}const a=TreeComponent}}]);