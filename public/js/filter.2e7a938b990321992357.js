"use strict";(self.webpackChunklinkspace=self.webpackChunklinkspace||[]).push([[181,202],{34789:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});const r=e=>{const t=[];let a=0;return e.records.forEach((e=>{e instanceof Object?t.push({name:e.label,id:e.id}):t.push({name:e,id:a++})})),t};class TypeaheadSourceOptions{constructor(e,t,a,r,i,s){this.name=e,this.ajaxSource=t,this.mapper=a,this.appendQuery=r,this.data=i,this.dataBuilder=s}}a(67751);var i=a(6016),s=a.n(i);class Typeahead{constructor(e,t,a){this.$input=e,this.callback=t,this.sourceOptions=a,this.init()}init(){const{appendQuery:e,mapper:t,name:a,ajaxSource:r}=this.sourceOptions,i=new(s())({datumTokenizer:s().tokenizers.whitespace,queryTokenizer:s().tokenizers.whitespace,remote:{url:r+(e?"%QUERY":""),wildcard:"%QUERY",transform:e=>t(e),rateLimitBy:"debounce",rateLimitWait:300,cache:!1}});this.$input.typeahead({hint:!1,highlight:!1,minLength:1},{name:a,source:i,display:"name",limit:20,templates:{suggestion:e=>`<div>${e.name}</div>`,pending:()=>"<div>Loading...</div>",notFound:()=>"<div>No results found</div>"}}),this.$input.on("typeahead:select",((e,t)=>{this.callback(t)})),window.test&&(this.$input.on("typeahead:asyncrequest",(()=>{console.log("Typeahead async request")})),this.$input.on("typeahead:asyncreceive",(()=>{console.log("Typeahead async receive")})),this.$input.on("typeahead:asynccancel",(()=>{console.log("Typeahead async cancel")})))}}const n=class TypeaheadBuilder{constructor(){this.mapper=e=>e.map((e=>({name:e.name,id:e.id}))),this.appendQuery=!1,this.data=void 0}withInput(e){return this.$input=e,this}withCallback(e){return this.callback=e,this}withName(e){return this.name=e,this}withAjaxSource(e){return this.ajaxSource=e,this}withAppendQuery(e=!0){return this.appendQuery=e,this}withData(e){return this.dataBuilder=void 0,this.data=e,this}withMapper(e){return this.mapper=e,this}withDefaultMapper(){return this.mapper=r,this}withDataBuilder(e){return this.data=void 0,this.dataBuilder=e,this}build(){if(!this.$input)throw new Error("Input not set");if(!this.callback)throw new Error("Callback not set");if(!this.name)throw new Error("Name not set");if(!this.ajaxSource)throw new Error("Ajax source not set");const e=new TypeaheadSourceOptions(this.name,this.ajaxSource,this.mapper,this.appendQuery,this.data,this.dataBuilder);return new Typeahead(this.$input,this.callback,e)}}},96059:(e,t,a)=>{a.d(t,{T:()=>i});var r=a(74692);const i=e=>{const t=[],a=[];e.on("afterCreateRuleFilters.queryBuilder",((e,a)=>{const i=r(a.$el.find(`select[name=${a.id}_filter]`));t.includes(i[0])||t.push(i[0]),i&&i[0]?(i.data("live-search","true"),i.selectpicker()):console.error("No select found")})),e.on("afterCreateRuleOperators.queryBuilder",((e,t,i)=>{const s=r(t.$el.find(`select[name=${t.id}_operator]`));s&&s[0]?(a.includes(s[0])||a.push(s[0]),s.data("live-search")||(s.data("live-search","true"),s.selectpicker())):console.error("No operator select found")})),e.on("afterSetRules.queryBuilder",(()=>{for(const e of t)e&&r(e).selectpicker("refresh");for(const e of a)e&&r(e).selectpicker("refresh")})),e.on("afterSetRuleOperator.queryBuilder",(()=>{for(const e of a)e&&r(e).selectpicker("refresh")}))}},63768:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var r=a(17527),i=(a(63035),a(14536),a(11977)),s=a(34789),n=a(96059),l=a(74692);class FilterComponent extends r.uA{constructor(e){super(e),this.el=l(this.element),this.operators=[{type:"equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"not_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"less",accept_values:!0,apply_to:["string","number","datetime"]},{type:"less_or_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"greater",accept_values:!0,apply_to:["string","number","datetime"]},{type:"greater_or_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"contains",accept_values:!0,apply_to:["datetime","string"]},{type:"not_contains",accept_values:!0,apply_to:["datetime","string"]},{type:"begins_with",accept_values:!0,apply_to:["string"]},{type:"not_begins_with",accept_values:!0,apply_to:["string"]},{type:"is_empty",accept_values:!1,apply_to:["string","number","datetime"]},{type:"is_not_empty",accept_values:!1,apply_to:["string","number","datetime"]},{type:"changed_after",nb_inputs:1,accept_values:!0,multiple:!1,apply_to:["string","number","datetime"]}],this.ragProperties={input:"select",values:{b_red:"Red",c_amber:"Amber",c_yellow:"Yellow",d_green:"Green",a_grey:"Grey",e_purple:"Purple",d_blue:"Blue",b_attention:"Red (Attention)"}},this.initFilter()}initFilter(){const e=this,t=this.el,a=l(this.el).data("builder-id"),r=l(`#builder_json_${a}`);if(!r.length)return;const o=JSON.parse(r.html()),u=t.data("filter-base");if(o.filters.length&&(o.filterNotDone&&this.makeUpdateFilter(),(0,n.T)(this.el),t.queryBuilder({showPreviousValues:o.showPreviousValues,filters:o.filters.map((e=>this.buildFilter(o,e))),allow_empty:!0,operators:this.operators,lang:{operators:{changed_after:"changed on or after"}}}),t.on("validationError.queryBuilder",(function(e,t,a,r){i.m.log(a),i.m.log(r),i.m.log(e),i.m.log(t)})),t.on("afterCreateRuleInput.queryBuilder",(function(t,a){let r;if(o.filters.forEach((function(e){if(e.filterId===a.filter.id)return r=e,!1})),!r||"rag"===r.type||!r.hasFilterTypeahead)return;const i=l(`#${a.id} .rule-value-container input[type='text']`),n=l(`#${a.id} .rule-value-container input[type='hidden']`);i.attr("autocomplete","off"),i.on("keyup",(()=>{n.val(i.val())}));(new s.default).withInput(i).withAjaxSource(e.getURL(o.layoutId,r.urlSuffix)).withDataBuilder((()=>({q:i.val(),oi:r.instanceId}))).withDefaultMapper().withName("rule").withAppendQuery().withCallback((e=>{r.useIdInFilter?n.val(e.id):n.val(e.name)})).build()})),u)){const e=atob(u,"base64");try{const a=JSON.parse(e);a.rules&&a.rules.length?t.queryBuilder("setRules",a):t.queryBuilder("setRules",{rules:[]})}catch(e){i.m.log("Incorrect data object passed to queryBuilder")}}}getURL(e,t){const a=window.siteConfig&&window.siteConfig.urls.filterApi;return a||`/${e}/match/layout/${t}?q=`}makeUpdateFilter(){window.UpdateFilter=(e,t)=>{e.queryBuilder("validate")||t.preventDefault();const a=e.queryBuilder("getRules");l("#filter").val(JSON.stringify(a,null,2))}}buildFilter=(e,t)=>({id:t.filterId,label:t.label,type:"string",operators:this.buildFilterOperators(t.type),..."rag"===t.type?this.ragProperties:t.hasFilterTypeahead?this.typeaheadProperties:{}});buildFilterOperators(e){if(!["date","daterange"].includes(e))return;const t=["equal","not_equal","less","less_or_equal","greater","greater_or_equal","is_empty","is_not_empty"];return"daterange"===e&&t.push("contain"),t}get typeaheadProperties(){return{input:(e,t)=>`<div class='tt__container'>\n            <input class='form-control typeahead_text' type='text' name='${t}_text'/>\n            <input class='form-control typeahead_hidden' type='hidden' name='${t}'/>\n          </div>`,valueSetter:(e,t)=>{e.$el.find(".typeahead_hidden").val(t);const a=e.$el.find(".typeahead_text");a.typeahead("val",e.data.text),a.val(e.data.text)},validation:{callback:()=>!0}}}getRecords=(e,t,a,r)=>l.ajax({type:"GET",url:this.getURL(e,t),data:{q:r,oi:a},dataType:"json",path:"records"})}const o=FilterComponent}}]);