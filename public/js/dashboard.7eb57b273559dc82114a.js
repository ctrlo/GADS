(self.webpackChunklinkspace=self.webpackChunklinkspace||[]).push([[945],{71565:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>w});var a=i(17527),s=(i(95191),i(60412),i(95257),i(57655),i(60949),i(3580),i(56803),i(32343),i(96540)),n=i(40961),r=i(2076),o=i.n(r),l=i(20312),d=i.n(l),c=i(66816),h=i.n(c);const m=({hMargin:e,dashboards:t,currentDashboard:i,loading:a,includeH1:n})=>s.createElement("div",{className:"content-block__navigation",style:{marginLeft:e,marginRight:e}},s.createElement("div",{className:"content-block__navigation-left"},a?s.createElement("p",{className:"spinner"},s.createElement("i",{className:"fa fa-spinner fa-spin"})):null,s.createElement("div",{className:"list list--horizontal list--no-borders"},s.createElement("ul",{id:"menu_view",className:"list__items",role:"menu"},t.map(((e,t)=>s.createElement("li",{className:"list__item",key:t},(e=>e.name===i.name?n?s.createElement("h1",null,s.createElement("span",{className:"link link--primary link--active"},e.name)):s.createElement("span",{className:"link link--primary link--active"},e.name):s.createElement("a",{className:"link link--primary",href:e.url},s.createElement("span",null,e.name)))(e))))))));class Widget extends s.Component{constructor(e){super(e),this.shouldComponentUpdate=e=>e.widget.html!==this.props.widget.html,this.componentDidUpdate=()=>{this.initializeLinkspace()},this.initializeLinkspace=()=>{this.ref&&(0,a.VZ)(this.ref.current)},this.ref=s.createRef()}render(){return s.createElement(s.Fragment,null,s.createElement("div",{className:"ld-widget"},s.createElement("div",{ref:this.ref,dangerouslySetInnerHTML:{__html:this.props.widget.html}}),this.props.readOnly?null:s.createElement(s.Fragment,null,s.createElement("a",{className:"ld-edit-button",onClick:this.props.onEditClick},s.createElement("span",null,"edit widget")),s.createElement("span",{className:"ld-draggable-handle"},s.createElement("span",null,"drag widget")))))}}const u=({addWidget:e,widgetTypes:t,currentDashboard:i,readOnly:a,noDownload:n})=>s.createElement("div",{className:"ld-footer-container"},n?null:s.createElement("div",{className:"btn-group mb-3 mb-md-0 mr-md-4"},s.createElement("button",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-expanded":"false","aria-controls":"menu_view"},"Download ",s.createElement("span",{className:"caret"})),s.createElement("div",{className:"dropdown-menu dropdown__menu dropdown-menu-right scrollable-menu",role:"menu"},s.createElement("ul",{id:"menu_view",className:"dropdown__list"},s.createElement("li",{className:"dropdown__item"},s.createElement("a",{className:"link link--plain",href:i.download_url},"As PDF"))))),a?null:s.createElement("div",{className:"btn-group"},s.createElement("button",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-expanded":"false","aria-controls":"menu_view"},"Add Widget"),s.createElement("div",{className:"dropdown-menu dropdown__menu dropdown-menu-right scrollable-menu",role:"menu"},s.createElement("ul",{id:"menu_view",className:"dropdown__list"},t.map((t=>s.createElement("li",{key:t,className:"dropdown__item"},s.createElement("a",{className:"link link--plain",href:"#",onClick:i=>{i.preventDefault(),e(t)}},t))))))));var p=i(63513);const g=(0,c.WidthProvider)(h()),f={content:{minWidth:"350px",maxWidth:"80vw",maxHeight:"90vh",top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",msTransform:"translate(-50%, -50%)",padding:0},overlay:{zIndex:1030,background:"rgba(0, 0, 0, .15)"}};class App extends s.Component{constructor(e){super(e),this.componentDidMount=()=>{this.initializeGlobeComponents()},this.componentDidUpdate=(e,t)=>{window.requestAnimationFrame(this.overWriteSubmitEventListener),this.state.editModalOpen&&t.loadingEditHtml&&!this.state.loadingEditHtml&&this.formRef&&this.initializeSummernoteComponent(),this.state.editModalOpen||t.loadingEditHtml||this.state.loadingEditHtml||this.initializeGlobeComponents()},this.initializeSummernoteComponent=()=>{const e=this.formRef.current.querySelector(".summernote");e&&Promise.all([i.e(888),i.e(258)]).then(i.bind(i,38258)).then((({default:t})=>{new t(e)}))},this.initializeGlobeComponents=()=>{const e=document.querySelectorAll(".globe");i.e(902).then(i.bind(i,63314)).then((({default:t})=>{e.forEach((e=>{new t(e)}))}))},this.updateWidgetHtml=async e=>{const t=await this.props.api.getWidgetHtml(e),i=this.state.widgets.map((i=>i.config.i===e?{...i,html:t}:i));this.setState({widgets:i})},this.fetchEditForm=async e=>{const t=await this.props.api.getEditForm(e);t.is_error?this.setState({loadingEditHtml:!1,editError:t.message}):this.setState({loadingEditHtml:!1,editError:!1,editHtml:t.content})},this.onEditClick=e=>t=>{t.preventDefault(),this.showEditForm(e)},this.showEditForm=e=>{this.setState({editModalOpen:!0,loadingEditHtml:!0,activeItem:e}),this.fetchEditForm(e)},this.closeModal=()=>{this.setState({editModalOpen:!1})},this.deleteActiveWidget=()=>{window.confirm("Deleting a widget is permanent! Are you sure?")&&(this.setState({widgets:this.state.widgets.filter((e=>e.config.i!==this.state.activeItem)),editModalOpen:!1}),this.props.api.deleteWidget(this.state.activeItem))},this.saveActiveWidget=async e=>{e.preventDefault();const t=this.formRef.current.querySelector("form");if(!t)return void console.error("No form element was found!");const i=o()(t,{hash:!0}),a=await this.props.api.saveWidget(t.getAttribute("action"),i);a.is_error?this.setState({editError:a.message}):(this.updateWidgetHtml(this.state.activeItem),this.closeModal())},this.isGridConflict=(e,t,i,a)=>{const s=e,n=t,r=e+i,o=t+a;return this.state.layout.some((e=>!(s>=e.x+e.w||e.x>=r)&&!(n>=e.y+e.h||e.y>=o)))},this.firstAvailableSpot=(e,t)=>{let i=0,a=0;for(;this.isGridConflict(i,a,e,t)&&(i+e<this.props.gridConfig.cols?i+=1:(i=0,a+=1),!(a>200)););return{x:i,y:a}},this.addWidget=async e=>{this.setState({loading:!0});const t=await this.props.api.createWidget(e);if(t.error)return this.setState({loading:!1}),void alert(t.message);const i=t.message,{x:a,y:s}=this.firstAvailableSpot(1,1),n={i,x:a,y:s,w:1,h:1},r=this.state.layout.concat(n);this.setState({widgets:this.state.widgets.concat({config:n,html:"Loading..."}),layout:r,loading:!1},(()=>this.updateWidgetHtml(i))),this.props.api.saveLayout(this.props.dashboardId,r),this.showEditForm(i)},this.generateDOM=()=>this.state.widgets.map((e=>s.createElement("div",{key:e.config.i,className:"ld-widget-container "+(this.props.readOnly||e.config.static?"":"ld-widget-container--editable")},s.createElement(Widget,{key:e.config.i,widget:e,readOnly:this.props.readOnly||e.config.static,onEditClick:this.onEditClick(e.config.i)})))),this.onLayoutChange=e=>{this.shouldSaveLayout(this.state.layout,e)&&this.props.api.saveLayout(this.props.dashboardId,e),this.setState({layout:e})},this.shouldSaveLayout=(e,t)=>{if(e.length!==t.length)return!0;for(let i=0;i<e.length;i+=1){if(Object.entries(t[i]).some((t=>{const[a,s]=t;return"moved"!==a&&"static"!==a&&s!==e[i][a]})))return!0}return!1},this.renderModal=()=>s.createElement(d(),{isOpen:this.state.editModalOpen,onRequestClose:this.closeModal,style:f,shouldCloseOnOverlayClick:!0,contentLabel:"Edit Modal"},s.createElement("div",{className:"modal-header"},s.createElement("div",{className:"modal-header__content"},s.createElement("h3",{className:"modal-title"},"Edit widget")),s.createElement("button",{className:"close",onClick:this.closeModal},s.createElement("span",{"aria-hidden":"true",className:"hidden"},"Close"))),s.createElement("div",{className:"modal-body"},this.state.editError?s.createElement("p",{className:"alert alert-danger"},this.state.editError):null,this.state.loadingEditHtml?s.createElement("span",{className:"ld-modal__loading"},"Loading..."):s.createElement("div",{ref:this.formRef,dangerouslySetInnerHTML:{__html:this.state.editHtml}})),s.createElement("div",{className:"modal-footer"},s.createElement("div",{className:"modal-footer__left"},s.createElement("button",{className:"btn btn-cancel",onClick:this.deleteActiveWidget},"Delete")),s.createElement("div",{className:"modal-footer__right"},s.createElement("button",{className:"btn btn-default",onClick:this.saveActiveWidget},"Save")))),this.overWriteSubmitEventListener=()=>{const e=document.getElementById("ld-form-container");if(!e)return;const t=e.querySelector("form");if(!t)return;t.addEventListener("submit",this.saveActiveWidget);const i=document.createElement("input");i.setAttribute("type","submit"),i.setAttribute("style","visibility: hidden"),t.appendChild(i)},this.handleSideBarChange=()=>{window.dispatchEvent(new Event("resize"))},d().setAppElement("#ld-app");const t=e.widgets.map((e=>e.config));this.formRef=s.createRef(),p.W.addSubscriber(this),this.state={widgets:e.widgets,layout:t,editModalOpen:!1,activeItem:0,editHtml:"",editError:null,loading:!1,loadingEditHtml:!0}}render(){return s.createElement("div",{className:"content-block"},this.props.hideMenu?null:s.createElement(m,{hMargin:this.props.gridConfig.containerPadding[0],dashboards:this.props.dashboards,currentDashboard:this.props.currentDashboard,loading:this.state.loading,includeH1:this.props.includeH1}),this.renderModal(),s.createElement("div",{className:"content-block__main"},s.createElement(g,{className:"content-block__main-content "+(this.props.readOnly?"":"react-grid-layout--editable"),isDraggable:!this.props.readOnly,isResizable:!this.props.readOnly,draggableHandle:".ld-draggable-handle",useCSSTransforms:!1,layout:this.state.layout,onLayoutChange:this.onLayoutChange,items:this.state.layout.length,...this.props.gridConfig},this.generateDOM())),this.props.hideMenu?null:s.createElement(u,{addWidget:this.addWidget,widgetTypes:this.props.widgetTypes,currentDashboard:this.props.currentDashboard,noDownload:this.props.noDownload,readOnly:this.props.readOnly}))}}const E=App;class ApiClient{constructor(e=""){this.saveLayout=(e,t)=>{if(!this.isDev){const i=t.map((e=>({...e,moved:void 0})));return this.PUT(`/dashboard/${e}`,i)}},this.createWidget=async e=>{const t=this.isDev?await this.GET(`/widget/create.json?type=${e}`):await this.POST(`/widget?type=${e}`,null);return await t.json()},this.getWidgetHtml=async e=>(this.isDev?await this.GET(`/widget/${e}/create`):await this.GET(`/widget/${e}`)).text(),this.deleteWidget=e=>!this.isDev&&this.DELETE(`/widget/${e}`),this.getEditForm=async e=>(await this.GET(`/widget/${e}/edit`)).json(),this.saveWidget=async(e,t)=>{const i=this.isDev?await this.GET("/widget/update.json"):await this.PUT(`${e}`,t);return await i.json()},this.baseUrl=e,this.headers={},this.isDev=window.siteConfig&&window.siteConfig.isDev}async _fetch(e,t,i){if(!e)throw new Error("Route is undefined");let a="";if("POST"===t||"PUT"===t||"PATCH"===t||"DELETE"===t){const t=document.querySelector("body"),i=t?t.getAttribute("data-csrf"):null;i&&(a=e.indexOf("?")>-1?`&csrf-token=${i}`:`?csrf-token=${i}`)}const s=`${this.baseUrl}${e}${a}`,n={method:t,headers:Object.assign(this.headers),credentials:"same-origin"};return i&&(n.body=JSON.stringify(i)),fetch(s,n)}GET(e){return this._fetch(e,"GET",null)}POST(e,t){return this._fetch(e,"POST",t)}PUT(e,t){return this._fetch(e,"PUT",t)}PATCH(e,t){return this._fetch(e,"PATCH",t)}DELETE(e){return this._fetch(e,"DELETE",null)}}var b=i(74692);class DashboardComponent extends a.uA{constructor(e){super(e),this.el=b(this.element),this.gridConfig={cols:2,margin:[32,32],containerPadding:[0,10],rowHeight:80},this.initDashboard()}initDashboard(){this.element.className="";const e=Array.prototype.slice.call(document.querySelectorAll("#ld-app > div")).map((e=>({html:e.innerHTML,config:JSON.parse(e.getAttribute("data-grid"))}))),t=new ApiClient(this.element.getAttribute("data-dashboard-endpoint")||"");n.render(s.createElement(E,{widgets:e,dashboardId:this.element.getAttribute("data-dashboard-id"),currentDashboard:JSON.parse(this.element.getAttribute("data-current-dashboard")||"{}"),readOnly:"true"===this.element.getAttribute("data-dashboard-read-only"),hideMenu:"true"===this.element.getAttribute("data-dashboard-hide-menu"),includeH1:"true"===this.element.getAttribute("data-dashboard-include-h1"),noDownload:"true"===this.element.getAttribute("data-dashboard-no-download"),api:t,widgetTypes:JSON.parse(this.element.getAttribute("data-widget-types")||"[]"),dashboards:JSON.parse(this.element.getAttribute("data-dashboards")||"[]"),gridConfig:this.gridConfig}),this.element)}}const w=DashboardComponent},32343:()=>{"document"in self&&((!("classList"in document.createElement("_"))||document.createElementNS&&!("classList"in document.createElementNS("http://www.w3.org/2000/svg","g")))&&function(e){"use strict";if("Element"in e){var t="classList",i="prototype",a=e.Element[i],s=Object,n=String[i].trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array[i].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},o=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new o("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new o("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(e,t)},d=function(e){for(var t=n.call(e.getAttribute("class")||""),i=t?t.split(/\s+/):[],a=0,s=i.length;a<s;a++)this.push(i[a]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},c=d[i]=[],h=function(){return new d(this)};if(o[i]=Error[i],c.item=function(e){return this[e]||null},c.contains=function(e){return-1!==l(this,e+="")},c.add=function(){var e,t=arguments,i=0,a=t.length,s=!1;do{-1===l(this,e=t[i]+"")&&(this.push(e),s=!0)}while(++i<a);s&&this._updateClassName()},c.remove=function(){var e,t,i=arguments,a=0,s=i.length,n=!1;do{for(t=l(this,e=i[a]+"");-1!==t;)this.splice(t,1),n=!0,t=l(this,e)}while(++a<s);n&&this._updateClassName()},c.toggle=function(e,t){e+="";var i=this.contains(e),a=i?!0!==t&&"remove":!1!==t&&"add";return a&&this[a](e),!0===t||!1===t?t:!i},c.toString=function(){return this.join(" ")},s.defineProperty){var m={get:h,enumerable:!0,configurable:!0};try{s.defineProperty(a,t,m)}catch(e){void 0!==e.number&&-2146823252!==e.number||(m.enumerable=!1,s.defineProperty(a,t,m))}}else s[i].__defineGetter__&&a.__defineGetter__(t,h)}}(self),function(){"use strict";var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var i,a=arguments.length;for(i=0;i<a;i++)e=arguments[i],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var i=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:i.call(this,e)}}e=null}())}}]);